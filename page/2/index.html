<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Make more time">
<meta property="og:type" content="website">
<meta property="og:title" content="易天行">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="易天行">
<meta property="og:description" content="Make more time">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="易天行">
<meta name="twitter:description" content="Make more time">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>易天行</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">易天行</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">积累点滴，汇聚江河</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/29/windows下mongodb的安装和配置记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/29/windows下mongodb的安装和配置记录/" itemprop="url">Windows下MongoDB的安装配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-29T16:20:13+08:00">
                2017-03-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="windows下mongodb的安装配置"><a href="#windows下mongodb的安装配置" class="headerlink" title="windows下mongodb的安装配置"></a>windows下mongodb的安装配置</h1><p>2017年3月29日，系统：win10，mongodb version v3.4.2</p>
<h2 id="下载和安装"><a href="#下载和安装" class="headerlink" title="下载和安装"></a>下载和安装</h2><ol>
<li>下载地址：<a href="https://www.mongodb.com/download-center#community" target="_blank" rel="noopener">https://www.mongodb.com/download-center#community</a></li>
<li>下载符合你系统的版本，然后安装。默认安装到<code>C:\Program Files\MongoDB</code>,你也可以自定义安装目录。</li>
</ol>
<h2 id="创建数据目录"><a href="#创建数据目录" class="headerlink" title="创建数据目录"></a>创建数据目录</h2><p>MongoDB将数据目录存储在 db 目录下。但是这个数据目录不会主动创建，我们在安装完成后需要创建它。</p>
<p>请注意，<strong>数据目录应该放在根目录下</strong>（(如： C:\ 或者 D:\ 等 )。</p>
<p>这里我们假设创建数据目录在<code>E:\data\db</code></p>
<h2 id="命令行运行mogondb服务"><a href="#命令行运行mogondb服务" class="headerlink" title="命令行运行mogondb服务"></a>命令行运行mogondb服务</h2><p>假设你的mongodb安装在<code>C:\Program Files\MongoDB</code>:</p>
<p>进入安装目录：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> C:\Program Files\MongoDB\Server\3.4\bin</span><br></pre></td></tr></table></figure>
<p>启动服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mongod.exe --dbpath e:\data\db</span><br></pre></td></tr></table></figure>
<h2 id="将MongoDB服务器作为Windows服务运行"><a href="#将MongoDB服务器作为Windows服务运行" class="headerlink" title="将MongoDB服务器作为Windows服务运行"></a>将MongoDB服务器作为Windows服务运行</h2><p>在命令行中启动服务之后，执行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mongod.exe --logpath <span class="string">"e:\data\dbConf\mongodb.log"</span> --logappend --dbpath <span class="string">"e:/data/db"</span> --port 27017 --serviceName <span class="string">"MongoDB"</span> --install</span><br></pre></td></tr></table></figure>
<p>终止命令行中的mongodb服务，打开刚才新建的mongodb服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">NET START MongoDB</span><br></pre></td></tr></table></figure>
<p>如果出现服务器无法正常启动的问题，是因为mongod.lock这个文件，在服务器异常退出时，该文件会影响下一次启动mongod服务的,我们首先关闭命令行mongodb服务，然后只需要删除该文件就行了：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mongod.exe --config e:\data\db\mongod.lock --remove</span><br></pre></td></tr></table></figure>
<blockquote>
<p>windows删除服务命令： <code>sc delete MongoDB</code></p>
</blockquote>
<p>说明：</p>
<p>请注意，你必须有管理权限才能运行下面的命令。执行以下命令将MongoDB服务器作为Windows服务运行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mongod.exe --bind_ip yourIPadress --logpath <span class="string">"C:\data\dbConf\mongodb.log"</span> --logappend --dbpath <span class="string">"C:\data\db"</span> --port yourPortNumber --serviceName <span class="string">"YourServiceName"</span> --serviceDisplayName <span class="string">"YourServiceName"</span> --install</span><br></pre></td></tr></table></figure>
<p>下表为mongodb启动的参数说明：</p>
<p>参数    描述</p>
<p>–bind_ip    绑定服务IP，若绑定127.0.0.1，则只能本机访问，不指定默认本地所有IP</p>
<p>–logpath    定MongoDB日志文件，注意是指定文件不是目录</p>
<p>–logappend    使用追加的方式写日志</p>
<p>–dbpath    指定数据库路径</p>
<p>–port    指定服务端口号，默认端口27017</p>
<p>–serviceName    指定服务名称</p>
<p>–serviceDisplayName    指定服务名称，有多个mongodb服务时执行。</p>
<p>–install    指定作为一个Windows服务安装。</p>
<h2 id="MongoDB后台管理-Shell"><a href="#MongoDB后台管理-Shell" class="headerlink" title="MongoDB后台管理 Shell"></a>MongoDB后台管理 Shell</h2><p>进入安装目录：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> C:\Program Files\MongoDB\Server\3.4\bin</span><br><span class="line">mongo.exe</span><br></pre></td></tr></table></figure>
<p><code>db</code> 命令用于查看当前操作的文档（数据库）</p>
<p>插入一些简单的记录并查找它：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; db.runoob.insert(&#123;x:10&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">&gt; db.runoob.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5604ff74a274a611b0c990aa&quot;), &quot;x&quot; : 10 &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>本文章写于，2017年3月29日，测试环境：mongodb版本 v3.4.2，操作系统win10</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/22/babel-cli入门使用步骤/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/22/babel-cli入门使用步骤/" itemprop="url">babel-cli入门使用步骤</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-22T00:00:00+08:00">
                2017-03-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="babel"><a href="#babel" class="headerlink" title="babel"></a>babel</h1><h2 id="babel-cli"><a href="#babel-cli" class="headerlink" title="babel-cli"></a>babel-cli</h2><p>项目中遇到了一个es6写的文件代码，在某些老的android设备的webview运行环境中不支持es6，比如<code>class</code>，<code>扩展运算符</code>等，使用这个解决方案：用<code>babel-cli</code>和<code>babel-preset-es2015</code>插件，把代码转为es5的代码。下面是具体步骤：</p>
<h3 id="1-全局安装babel-cli"><a href="#1-全局安装babel-cli" class="headerlink" title="1.全局安装babel-cli"></a>1.全局安装babel-cli</h3><p><code>$ npm install --global babel-cli</code></p>
<p><code>babel</code>提供命令行工具，用来在命令行转码，参考：<a href="http://babeljs.cn/docs/usage/cli/" target="_blank" rel="noopener">官方文档</a></p>
<p>基本用法如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 转码结果输出到标准输出</span></span><br><span class="line">$ babel example.js</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转码结果写入一个文件</span></span><br><span class="line"><span class="comment"># --out-file 或 -o 参数指定输出文件</span></span><br><span class="line">$ babel example.js --out-file compiled.js</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">$ babel example.js -o compiled.js</span><br><span class="line"></span><br><span class="line"><span class="comment"># 整个目录转码</span></span><br><span class="line"><span class="comment"># --out-dir 或 -d 参数指定输出目录</span></span><br><span class="line">$ babel src --out-dir lib</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">$ babel src -d lib</span><br><span class="line"></span><br><span class="line"><span class="comment"># -s 参数生成source map文件</span></span><br><span class="line">$ babel src -d lib -s</span><br></pre></td></tr></table></figure>
<h3 id="2-项目中新建-babelrc-配置文件"><a href="#2-项目中新建-babelrc-配置文件" class="headerlink" title="2.项目中新建.babelrc 配置文件"></a>2.项目中新建.babelrc 配置文件</h3><p><code>.babelrc</code>它是<code>babel</code>的配置文件，存放在项目的根目录下面，用来设置转码规则和插件。基本格式如下：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"presets"</span>: [</span><br><span class="line">      <span class="string">"es2015"</span>,</span><br><span class="line">      <span class="string">"react"</span>,</span><br><span class="line">      <span class="string">"stage-2"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"plugins"</span>: []</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>presets字段设定<code>转码规则</code>，官方提供以下的规则集，你可以根据需要安装。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ES2015转码规则</span></span><br><span class="line">$ npm install --save-dev babel-preset-es2015</span><br><span class="line"></span><br><span class="line"><span class="comment"># react转码规则</span></span><br><span class="line">$ npm install --save-dev babel-preset-react</span><br><span class="line"></span><br><span class="line"><span class="comment"># ES7不同阶段语法提案的转码规则（共有4个阶段），选装一个</span></span><br><span class="line">$ npm install --save-dev babel-preset-stage-0</span><br><span class="line">$ npm install --save-dev babel-preset-stage-1</span><br><span class="line">$ npm install --save-dev babel-preset-stage-2</span><br><span class="line">$ npm install --save-dev babel-preset-stage-3</span><br></pre></td></tr></table></figure>
<h3 id="3-安装es2015插件"><a href="#3-安装es2015插件" class="headerlink" title="3.安装es2015插件"></a>3.安装es2015插件</h3><p><code>$ npm install --save-dev babel-preset-es2015</code></p>
<p>修改配置文件为：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"presets"</span>: [</span><br><span class="line">      <span class="string">"es2015"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"plugins"</span>: []</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-在命令行中使用命令转码"><a href="#4-在命令行中使用命令转码" class="headerlink" title="4.在命令行中使用命令转码"></a>4.在命令行中使用命令转码</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ babel example.js -o compiled.js</span><br></pre></td></tr></table></figure>
<h2 id="关于babel-node"><a href="#关于babel-node" class="headerlink" title="关于babel-node"></a>关于babel-node</h2><p>babel-cli工具自带一个<code>babel-node</code>命令，提供一个支持ES6的REPL环境。它支持Node的REPL环境的所有功能，而且可以直接运行ES6代码。<br>它不用单独安装，而是随<code>babel-cli</code>一起安装。然后，执行babel-node就进入PEPL环境。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ babel-node</span><br><span class="line">&gt; (x =&gt; x * 2)(1)</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<p>babel-node命令可以直接运行ES6脚本。将上面的代码放入脚本文件es6.js，然后直接运行。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ babel-node es6.js</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<p>babel-node也可以安装在项目中。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm install --save-dev babel-cli</span><br></pre></td></tr></table></figure>
<p>然后，改写<code>package.json</code>。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"script-name"</span>: <span class="string">"babel-node script.js"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码中，使用babel-node替代node，这样script.js本身就不用做任何转码处理。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/22/ES6中5种遍历对象属性的方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/22/ES6中5种遍历对象属性的方法/" itemprop="url">ES6中5种遍历对象属性的方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-22T00:00:00+08:00">
                2017-03-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ES6中5种遍历对象属性的方法"><a href="#ES6中5种遍历对象属性的方法" class="headerlink" title="ES6中5种遍历对象属性的方法"></a>ES6中5种遍历对象属性的方法</h1><h3 id="5种遍历对象属性的方法："><a href="#5种遍历对象属性的方法：" class="headerlink" title="5种遍历对象属性的方法："></a>5种遍历对象属性的方法：</h3><ul>
<li><p>for…in<br><code>for...in</code>循环遍历自身的和继承的可枚举属性（不含Symbol属性）</p>
</li>
<li><p>Object.keys(obj)<br><code>Object.keys(obj)</code>返回一个数组，包括对象自身的（不含继承）所有可枚举属性（不含Symbol属性）</p>
</li>
<li><p>Object.getOwnPropertyNames(obj)<br><code>Object.getOwnPropertyNames(obj)</code>返回一个数组，包括对象自身（不含继承）所有属性（包括不可枚举的属性，不含Symbol属性）</p>
</li>
<li><p>Object.getOwnPropertySymbols(obj)<br><code>Object.getOwnPropertySymbols(obj)</code>返回一个数组，包括对象自身所有的Symbol属性</p>
</li>
<li><p>Reflect.ownKeys(obj)<br><code>Reflect.ownKeys(obj)</code>返回一个数组，包含对象自身的所有属性，不管属性名是Symbol或字符串，也不管是否可枚举</p>
</li>
</ul>
<p>###通过比较，可以得到结论：</p>
<ol>
<li>要想获得对象自身和它所继承的属性（可枚举的），必须用<code>for...in</code>，其它只与对象自身有关。</li>
<li><code>Object.keys(obj)</code>返回自身的<strong>可枚举属性</strong>。</li>
<li><code>Object.getOwnPropertyNames(obj)</code>比<code>Object.keys(obj)</code>多包含了对象自身的不可枚举属性。</li>
<li><code>Reflect.ownKeys(obj)</code>的返回结果是<code>Object.getOwnPropertyNames(obj)</code>和<code>Object.getOwnPropertySymbols(obj)</code>的合集。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/07/RxJs常用Operator记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/07/RxJs常用Operator记录/" itemprop="url">RxJs常用Operator记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-07T00:00:00+08:00">
                2017-03-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="RxJs中的operator"><a href="#RxJs中的operator" class="headerlink" title="RxJs中的operator"></a>RxJs中的operator</h1><h2 id="创建操作符"><a href="#创建操作符" class="headerlink" title="创建操作符"></a>创建操作符</h2><p>常见的有<code>Observable.forEvent()</code>,  <code>Observable.create()</code>, <code>Observable.interval()</code>。</p>
<h3 id="create"><a href="#create" class="headerlink" title="create"></a>create</h3><p><code>Observable.create()</code>：自定义创建一个<code>observable</code></p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;Observable&#125; = <span class="built_in">require</span>(<span class="string">'rxjs/Observable'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'rxjs/add/observable/of'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'rxjs/add/operator/map'</span>);</span><br><span class="line"><span class="comment">//create创建操作符</span></span><br><span class="line"><span class="keyword">let</span> observable = Observable.create(<span class="function"><span class="params">observer</span>=&gt;</span>&#123;</span><br><span class="line">    observer.next(<span class="number">3</span>);</span><br><span class="line">    observer.next(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observable.subscribe(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="interval"><a href="#interval" class="headerlink" title="interval"></a>interval</h3><p><code>interval(time:number)</code>:创建一个递增序列，每隔指定时间发送一条数据</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers = Rx.Observable.interval(<span class="number">1000</span>);</span><br><span class="line">numbers.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x));  <span class="comment">// 0 1 2 3 4 5 6 ......</span></span><br></pre></td></tr></table></figure>
<h3 id="of"><a href="#of" class="headerlink" title="of"></a>of</h3><p><code>public static of(values: ...T, scheduler: Scheduler): Observable&lt;T&gt;</code>: 从数组创建一个序列，一次将数据发射出去，然后发射完成命令</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers = Rx.Observable.of(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>);</span><br><span class="line"><span class="keyword">var</span> letters = Rx.Observable.of(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>);</span><br><span class="line"><span class="keyword">var</span> result = numbers.concat(letters);</span><br><span class="line">result.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x));  <span class="comment">//10 20 30 a b c</span></span><br></pre></td></tr></table></figure>
<h2 id="变换操作符"><a href="#变换操作符" class="headerlink" title="变换操作符"></a>变换操作符</h2><p>对每一次返回数据做一次变换操作，把原本的数据流变成需要的数据流，最常使用的变换操作是<code>observable.map()</code></p>
<p>比如，数据获取接口经常会有一些规范去包裹数据，比如</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;err_code&quot;:0,</span><br><span class="line">    &quot;data&quot;:&#123;&quot;name&quot;:&quot;Operators&quot;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们只需要data字段，就可以使用map来实现：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">observable.map(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.data;</span><br><span class="line">&#125;).subscribe(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//do sth with data</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="过滤操作符filter"><a href="#过滤操作符filter" class="headerlink" title="过滤操作符filter"></a>过滤操作符filter</h2><p>用于过滤掉数据流中一些不需要处理的数据，常用的是<code>observable.filter()</code><br>比如，前端获取数据的时候，接口可能会因为各种原因无法返回最终需要的数据，可能由于异常返回的数据为空，或者返回一个错误代码和错误描述告知前端，但是并不需要处理这些错误信息，就需要过滤掉这些错误数据。</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//过滤操作符</span></span><br><span class="line">observable.filter(<span class="function"><span class="params">response</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !!response.data &amp;&amp; response.status === <span class="number">200</span>;</span><br><span class="line">&#125;).map(<span class="function"><span class="params">response</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response.data;</span><br><span class="line">&#125;).subscribe(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//do sth with data</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="组合操作符"><a href="#组合操作符" class="headerlink" title="组合操作符"></a>组合操作符</h2><p>很多业务场景需要依赖两个甚至更多的接口数据，并且在这些接口数据都成功获取后，再进行关联合并。要满足这种场景，就需要把各个数据流汇汇合组成新的数据流，这时就要用到<code>组合操作符</code>，比如<code>Observable.forkJoin()</code>,<code>Observable.prototype.concatMap()</code></p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//组合操作符 Observable.forkJoin</span></span><br><span class="line"><span class="keyword">let</span> getFirstDataObs = Observable.create(<span class="function"><span class="params">observer</span> =&gt;</span> &#123;</span><br><span class="line">    observer.next(<span class="string">'a1'</span>);</span><br><span class="line">    observer.next(<span class="string">'a2'</span>);</span><br><span class="line">    observer.complete();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> getSecondDataObs = Observable.create(<span class="function"><span class="params">observer</span> =&gt;</span> &#123;</span><br><span class="line">    observer.next(<span class="string">'b1'</span>);</span><br><span class="line">    observer.next(<span class="string">'b2'</span>);</span><br><span class="line">    observer.complete();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> joinedObservable = Observable.forkJoin(</span><br><span class="line">    getFirstDataObs, getSecondDataObs</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">joinedObservable.subscribe(<span class="function"><span class="params">datas</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//data[0] 是getFirstDataObs 的数据</span></span><br><span class="line">    <span class="comment">//data[1] 是getSecondDataObs 的数据</span></span><br><span class="line">    <span class="comment">//只有在他两个都执行complete()之后，才会返回数据，且返回最后发送的数据</span></span><br><span class="line">    <span class="built_in">console</span>.log(datas);  <span class="comment">//[ 'a2', 'b2' ]</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果某次请求数据需要依赖前一次请求的结果，也就是说两次请求必须有先后顺序，这时候可以使用<code>Observalbe.prototype.concatMap()</code>,示例：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//concatMap</span></span><br><span class="line"><span class="keyword">let</span> getFirstDataObs = Observable.create(<span class="function"><span class="params">observer</span>=&gt;</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">res</span>=&gt;</span> &#123; observer.next(<span class="number">1</span>);&#125;, <span class="number">500</span>);</span><br><span class="line">    setTimeout(<span class="function"><span class="params">res</span>=&gt;</span> &#123; observer.next(<span class="number">2</span>);&#125;, <span class="number">1000</span>);</span><br><span class="line">    setTimeout(<span class="function"><span class="params">res</span>=&gt;</span> &#123; observer.next(<span class="number">3</span>);&#125;, <span class="number">1500</span>);</span><br><span class="line">    setTimeout(<span class="function"><span class="params">res</span>=&gt;</span> &#123; observer.complete();&#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> createSecondDataObs  = <span class="function">(<span class="params">firstData</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Observable.create(<span class="function"><span class="params">observer</span>=&gt;</span>&#123;</span><br><span class="line">        observer.next(firstData*<span class="number">10</span>+<span class="number">1</span>);</span><br><span class="line">        observer.next(firstData*<span class="number">10</span>+<span class="number">2</span>);</span><br><span class="line">        observer.next(firstData*<span class="number">10</span>+<span class="number">3</span>);</span><br><span class="line">        observer.complete();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> concatedObs = getFirstDataObs.concatMap(<span class="function"><span class="params">firstData</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> createSecondDataObs(firstData);</span><br><span class="line">&#125;).subscribe(<span class="function"><span class="params">secondData</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//do sth with second data</span></span><br><span class="line">    <span class="built_in">console</span>.log(secondData); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>结果输出：<code>11 12 13 21 22 23 31 32 33</code></p>
<p>通过<code>Observable.prototype.concatMap()</code>方法，<code>getSecondDataObs()</code>的数据流被紧接在<code>getFirstDataObs()</code>的数据流后，并且最终被数据流被subscribe()所捕获。</p>
<h2 id="工具操作符"><a href="#工具操作符" class="headerlink" title="工具操作符"></a>工具操作符</h2><p>在Observable.prototype中有很多有用的工具方法，统称为工具操作符，如<code>delay</code>,<code>timeout</code>,<code>debounce</code>,<code>take</code>,<code>takeUntil</code>,<code>takeLast</code>,<code>takeWhile</code>,<code>skip</code>等等</p>
<h3 id="timeout"><a href="#timeout" class="headerlink" title="timeout"></a>timeout</h3><p><code>timeout</code>:当observable在指定时间内数据没有完全返回时，发出一个错误</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//工具操作符timeout</span></span><br><span class="line"><span class="keyword">let</span> observable = Observable.create(<span class="function"><span class="params">observer</span> =&gt;</span> &#123;</span><br><span class="line">   observer.next(<span class="number">3</span>);</span><br><span class="line">   setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       observer.complete();</span><br><span class="line">   &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observable.timeout(<span class="number">2000</span>).subscribe(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">   <span class="comment">//do sth with data</span></span><br><span class="line">   <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;,<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">   handleError(err);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//当observable超过2000ms没有返回全部数据流（即返回complete时），便会抛出一个err错误，被handleError捕获。</span></span><br></pre></td></tr></table></figure>
<h3 id="delay"><a href="#delay" class="headerlink" title="delay"></a>delay</h3><p><code>delay</code>: 返回一个新序列，但是每个序列数据延迟指定时间<br><img src="http://ol1ftyec4.bkt.clouddn.com/2017-03-07-delay.png" alt="delay"></p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//延迟1000ms</span></span><br><span class="line">observable.delay(<span class="number">1000</span>).subscribe(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="debounceTime"><a href="#debounceTime" class="headerlink" title="debounceTime"></a>debounceTime</h3><p><code>public debounceTime(time: number)</code>: 和<code>delay</code>一样，也会延迟发送数据，但仅发送这一段时间内最新的<strong>一条</strong>消息，如果原序列在这段时间内没有发送消息，就不发送。比如可以用在，前台界面搜索框延迟500ms后自动发起api请求进行查询，或后台数据返回的太过频繁。<br><img src="http://ol1ftyec4.bkt.clouddn.com/2017-03-07-debounceTime-1.png" alt="debounceTime"></p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line">Observable.fromEvent(inputSelector,<span class="string">'keyup'</span>)</span><br><span class="line">    .debounceTime(<span class="number">500</span>)</span><br><span class="line">    .switchMap(<span class="function"><span class="params">event</span>=&gt;</span>getValue(event.target.value))</span><br><span class="line">    .subscribe(callback);</span><br></pre></td></tr></table></figure>
<h3 id="debounce"><a href="#debounce" class="headerlink" title="debounce"></a>debounce</h3><p><code>public debounce(durationSelector: function(value: T): SubscribableOrPromise): Observable</code>：和<code>debounceTime</code>类似，但它的发送时机不是由延迟时间决定，而是由另一个<code>observable</code>决定,</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>);</span><br><span class="line"><span class="keyword">var</span> result = clicks.debounce(<span class="function"><span class="params">()</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>));</span><br><span class="line">result.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x));</span><br></pre></td></tr></table></figure>
<h3 id="take"><a href="#take" class="headerlink" title="take"></a>take</h3><p><code>public take(count:number)</code>: 挑选出指定的前几个数据，作为新的序列，并complete<br><img src="http://ol1ftyec4.bkt.clouddn.com/2017-03-07-take.png" alt="take"></p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> interval = Rx.Observable.interval(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">var</span> five = interval.take(<span class="number">5</span>);  <span class="comment">//取出前5个数据</span></span><br><span class="line">five.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x)); <span class="comment">//0 1 2 3 4</span></span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### takeLast</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span>takeLast(count:<span class="built_in">number</span>)<span class="string">`：挑选出原序列的最后count个数据，在complete时一起发送出去</span></span><br><span class="line"><span class="string">![takeLast](http://ol1ftyec4.bkt.clouddn.com/2017-03-07-takeLast.png)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>ts</span><br><span class="line"><span class="keyword">let</span> interval = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">5</span>);</span><br><span class="line">five.takeLast(<span class="number">2</span>).subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x)); <span class="comment">//挑选出最后2个，打印：3 4</span></span><br></pre></td></tr></table></figure>
<h3 id="takeUntil"><a href="#takeUntil" class="headerlink" title="takeUntil"></a>takeUntil</h3><p><code>public takeUntil(notifier: Observable): Observable&lt;T&gt;</code>： 筛选原序列中数据，直到notifier发射出一个数据为止.(Lets values pass until a second Observable, notifier, emits something. Then, it completes.)</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> interval = Rx.Observable.interval(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>);</span><br><span class="line"><span class="keyword">var</span> result = interval.takeUntil(clicks);  <span class="comment">//一直从原序列中取数据，直到点击事件发生为止</span></span><br><span class="line">result.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x));</span><br></pre></td></tr></table></figure>
<h3 id="takeWhile"><a href="#takeWhile" class="headerlink" title="takeWhile"></a>takeWhile</h3><p><code>public takeWhile(predicate: function(value: T, index: number): boolean): Observable&lt;T&gt;</code> ：满足某个条件时不再从原序列中取数据<br><img src="http://ol1ftyec4.bkt.clouddn.com/2017-03-07-takeWhile.png" alt="takeWhile"></p>
<h3 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h3><p><code>public skip(count: Number): Observable</code>：跳过序列中的前<code>count</code>个数据</p>
<p><img src="http://ol1ftyec4.bkt.clouddn.com/2017-03-07-skip.png" alt="skip"></p>
<h3 id="switchMap"><a href="#switchMap" class="headerlink" title="switchMap"></a>switchMap</h3><p><code>public switchMap(project: function(value: T, ?index: number): ObservableInput, resultSelector: function(outerValue: T, innerValue: I, outerIndex: number, innerIndex: number): any): Observable</code>: 将原序列某个数据转换为另一个observable的若干个序列数据，当元序列有新数据到来时，会截断旧数据</p>
<p><a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#instance-method-switchMap" target="_blank" rel="noopener">switchMap官方说明</a></p>
<p><img src="http://ol1ftyec4.bkt.clouddn.com/2017-03-08-switchMap.png" alt="switchMap"></p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/03/JavaScript响应式编程 - RxJs入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/03/JavaScript响应式编程 - RxJs入门/" itemprop="url">JavaScript响应式编程 - RxJs入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-03T16:13:48+08:00">
                2017-03-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在angular2项目的过程中，接触到了Rxjs这个东西，对它进行了一下简单的了解，对它的基本用法进行了学习和总结，介绍了：</p>
<ul>
<li>基本概念</li>
<li>如何创建一个Observerble可观察序列</li>
<li>Observer实例的生命周期</li>
<li>如何对Observer实例进行订阅？以及监听他的next、error、complete事件？</li>
<li>rxjs交互图怎么看？</li>
<li>map、filter、from等简单的操作符含义</li>
</ul>
<h2 id="它是什么"><a href="#它是什么" class="headerlink" title="它是什么"></a>它是什么</h2><p>官方文档：<a href="http://reactivex.io/rxjs/" target="_blank" rel="noopener">http://reactivex.io/rxjs/</a></p>
<p><code>Rx</code>（<code>ReactiveX</code>, <code>Reactive Extensions</code>）,它是微软开发和维护的基于<code>响应式编程</code>（<code>Reactive Programming</code>）范式实现的一套工具库集合，于2012年11月开源，它提供了一系列接口规范来帮助开发者方便的处理异步数据流。Rx系列结合了观察者模式、迭代器模式、函数式编程，它已成为业界响应式编程的优秀实践。</p>
<p><code>RxJs</code>就是Rx在JavaScript层面上的实现，除此之外还有RxJava、Rx.Net、RxSwift等等。</p>
<p><code>RxJs</code>全名<code>Reactive Extensions for JavaScript</code>，翻译为<code>Javascript的响应式扩展</code>, 它的思路是把随时间不断变化的数据、状态、事件等等转成可被观察的序列(<code>Observable Sequence</code>)，然后订阅序列中那些Observable对象的变化，一旦变化，就会执行事先安排好的各种转换和操作。</p>
<h2 id="几个名词"><a href="#几个名词" class="headerlink" title="几个名词"></a>几个名词</h2><p><code>Observable</code>: <code>可观察的数据序列</code>.<br><code>Observer</code>: <code>观察者实例</code>，用来决定何时观察指定数据，只有在Rx.Observable.create创建方法可以获取<br><code>Subscription</code>: 观察数据序列返回的<code>订阅实例</code>.<br><code>Operators</code>: <code>Observable的操作符</code>，包括转换数据序列，过滤等，所有的Operators方法接受的参数是上一次发送的数据变更的值，而方法返回值我们称之为发射新数据变更</p>
<p><code>Observable</code>可以发射三种类型的事件：<code>next</code>、<code>error</code>、<code>complete</code><br><code>Subscription</code>可以订阅三种类型的事件：<code>onNext</code> <code>onError</code> <code>onComplete</code><br><code>Observable</code>有四个生命周期：创建 、订阅 、 执行 、销毁。</p>
<h2 id="使用create创建一个Observable"><a href="#使用create创建一个Observable" class="headerlink" title="使用create创建一个Observable"></a>使用create创建一个Observable</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Rx = <span class="built_in">require</span>(<span class="string">'rxjs/Rx'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;Observable&#125; = <span class="built_in">require</span>(<span class="string">'rxjs/Observable'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'rxjs/add/observable/of'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'rxjs/add/operator/map'</span>);</span><br><span class="line">    </span><br><span class="line"><span class="comment">//创建序列源</span></span><br><span class="line"><span class="keyword">const</span> source = Observable.create(<span class="function"><span class="params">observer</span>=&gt;</span>&#123;</span><br><span class="line">    observer.next(<span class="string">'foo'</span>);</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span> observer.next(<span class="string">'bar'</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//订阅</span></span><br><span class="line"><span class="keyword">const</span> subscription = source.subscribe(<span class="function"><span class="params">data</span>=&gt;</span><span class="built_in">console</span>.log(data));</span><br></pre></td></tr></table></figure>
<h2 id="捕获error和complete"><a href="#捕获error和complete" class="headerlink" title="捕获error和complete"></a>捕获error和complete</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> source = Observable.create(<span class="function"><span class="params">observer</span>=&gt;</span>&#123;</span><br><span class="line">    observer.next(<span class="string">'foo'</span>);                         <span class="comment">//发射数据</span></span><br><span class="line">    observer.error(<span class="string">'my error'</span>);                   <span class="comment">//发射错误</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span> observer.next(<span class="string">'bar'</span>), <span class="number">1000</span>);</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>observer.complete(),<span class="number">2000</span>);     <span class="comment">//发射完成</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> source1 = source.map(<span class="function"><span class="params">e</span>=&gt;</span><span class="string">`hello <span class="subst">$&#123;e&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subscription = source1</span><br><span class="line">    .subscribe(</span><br><span class="line">        data=&gt;<span class="built_in">console</span>.log(data),</span><br><span class="line">        error=&gt;<span class="built_in">console</span>.log(error),</span><br><span class="line">        ()=&gt;<span class="built_in">console</span>.log(<span class="string">'complete'</span>)</span><br><span class="line">        );</span><br></pre></td></tr></table></figure>
<h2 id="rxjs交互图"><a href="#rxjs交互图" class="headerlink" title="rxjs交互图"></a>rxjs交互图</h2><ul>
<li>每条线表示一个数据序列</li>
<li>每个球表示发送的数据变更，小竖线表示complete</li>
<li>方法下面表示经过map、filter等操作符处理过后产生的新序列</li>
</ul>
<p><img src="http://ol1ftyec4.bkt.clouddn.com/2017-03-07-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-03-03%2014.23.49.png" alt="屏幕快照 2017-03-03 14.23.49"></p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//序列1</span></span><br><span class="line"><span class="keyword">let</span> source = Observable.create(<span class="function"><span class="params">observer</span> =&gt;</span> &#123;</span><br><span class="line">    observer.next(<span class="number">1</span>);</span><br><span class="line">    observer.next(<span class="number">2</span>);</span><br><span class="line">    observer.next(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//序列2</span></span><br><span class="line"><span class="keyword">let</span> source2 = source.map(<span class="function"><span class="params">e</span>=&gt;</span>e=e*<span class="number">10</span>);</span><br><span class="line"><span class="comment">//订阅序列1</span></span><br><span class="line">source.subscribe(<span class="function"><span class="params">data</span>=&gt;</span><span class="built_in">console</span>.log(data));</span><br><span class="line"><span class="comment">//订阅序列2</span></span><br><span class="line">source2.subscribe(<span class="function"><span class="params">data</span>=&gt;</span><span class="built_in">console</span>.log(data));</span><br></pre></td></tr></table></figure>
<h2 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h2><p><code>map</code>：对要发送的data作统一处理后再返回<br><code>filter</code>：满足条件时才发射出去<br><code>toPromise</code>：将observer转为promise<br><code>debounce</code>：（防抖动）取一段时间内最新的数据<br><code>throttle</code>：(防抖动) 忽略这段时间，发现新值后再发送</p>
<p>更多，如 mapTo, scan, from ,concat, concatAll, merge, mergeAll等</p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>angular2中的HTTP模块，ionic-native中的BLE模块都默认使用了<code>Observable</code></p>
<p>还需要要研究：</p>
<ul>
<li>他的使用场景？</li>
<li>与promise相比他的优势劣势是什么？</li>
<li>未来的使用趋势如何？</li>
</ul>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p>官方文档：<a href="http://reactivex.io/rxjs/" target="_blank" rel="noopener">http://reactivex.io/rxjs/</a></p>
<p><a href="https://yq.aliyun.com/articles/65027" target="_blank" rel="noopener">rxjs简单入门</a></p>
<p><a href="http://www.oschina.net/translate/rxjs-streams?lang=chs&amp;page=1#" target="_blank" rel="noopener">使用 RxJS 实现 JavaScript 的 Reactive 编程</a></p>
<p><a href="https://dzone.com/refcardz/rxjs-streams" target="_blank" rel="noopener">Reactive Programming in JavaScript With RxJS</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/27/对node事件循环机制中Macrotask和Microtask的理解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/27/对node事件循环机制中Macrotask和Microtask的理解/" itemprop="url">对node事件循环机制中Macrotask和Microtask的理解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-27T10:38:23+08:00">
                2017-02-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="node事件循环机制中的Microtask和Macrotask"><a href="#node事件循环机制中的Microtask和Macrotask" class="headerlink" title="node事件循环机制中的Microtask和Macrotask?"></a>node事件循环机制中的<code>Microtask</code>和<code>Macrotask</code>?</h2><h3 id="他是什么？"><a href="#他是什么？" class="headerlink" title="他是什么？"></a>他是什么？</h3><p>在Nodejs事件循环机制中，有任务两个队列：<code>Macrotask队列</code>和<code>Microtask队列</code>。在一个事件循环里，这两个队列会分两步执行，第一步会固定地执行一个（且仅一个）Macrotask任务，第二步会执行整个Microtask队列中的所有任务。并且，在执行Microtask队列任务的时候，也允许加入新的Microtask任务，直到所有Microtask任务全部执行完毕，才会结束循环。</p>
<p>Macrotasks一般包括: <code>setTimeout</code>, <code>setInterval</code>, <code>setImmediate</code>, <code>I/O</code>, <code>UI rendering</code>；<br>Microtasks一般包括: <code>process.nextTick</code>, <code>Promises</code>, <code>Object.observe</code>, <code>MutationObserver</code>。</p>
<h3 id="node事件循环机制详解"><a href="#node事件循环机制详解" class="headerlink" title="node事件循环机制详解"></a>node事件循环机制详解</h3><p>从一个事件循环开始，到结束会经历以下步骤：</p>
<ol>
<li>检查Macrotask队列，选择其中最早加入（即最老的）的任务X，设置为“目前运行的任务”。如果任务X不存在，那么直接跳到步骤4。</li>
<li>运行任务X，即运行对应的回调函数。</li>
<li>设置“目前运行的任务”为null，从Macrotask队列中移除任务X。</li>
<li><p>检查Microtask队列：</p>
<ol>
<li>选择其中最老的任务a，如果任务a不存在，直接结束Microtask队列。</li>
<li>设置任务a为“目前运行的任务”，并执行。</li>
<li>设置“目前运行的任务”为null，从Microtask队列中移除任务a。</li>
<li>选择下一个最老的任务b，跳到步骤2）。</li>
<li>直到队列里没有剩余的任务，结束队列。</li>
</ol>
</li>
<li>跳回步骤1，检查下一个Macrotask任务。</li>
</ol>
<h3 id="如何选用Macrotask或Microtask呢？"><a href="#如何选用Macrotask或Microtask呢？" class="headerlink" title="如何选用Macrotask或Microtask呢？"></a>如何选用Macrotask或Microtask呢？</h3><p><strong><em>如果你想让一个任务立即执行，那么就把它设置为Microtask，除此之外都用Macrotask比较好。</em></strong></p>
<p>因为可以看出，虽然Node是异步非阻塞的，但<strong>在一个事件循环中，Microtask的执行方式基本上就是用同步的</strong>。</p>
<h3 id="有什么问题？"><a href="#有什么问题？" class="headerlink" title="有什么问题？"></a>有什么问题？</h3><p>如果<code>Microtask</code>任务列表太长，或不断加入新的<code>Microtask</code>，就会导致下一个<code>Macrotask</code>任务很久得不到执行，可能导致UI一直无法刷新或IO无法完成。</p>
<p>应该是考虑到了这一点，至少Microtask任务中的<code>process.nextTick</code>任务，是被设置了（在一个事件循环中的）最大调用次数的，叫<code>process.maxTickDepth</code>，默认是1000。一定程度上避免了上述情况。</p>
<h3 id="参考文档："><a href="#参考文档：" class="headerlink" title="参考文档："></a>参考文档：</h3><p><a href="https://segmentfault.com/a/1190000007710772" target="_blank" rel="noopener">Node.js事件循环中的：Macrotask 与 Microtask</a></p>
<p><a href="https://segmentfault.com/a/1190000002914296" target="_blank" rel="noopener">Node.js事件驱动实现概览</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/27/js面试题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/27/js面试题/" itemprop="url">函数闭包、IIFE、JS解释器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-27T09:53:44+08:00">
                2017-02-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在掘金上看到了篇文章，里面讲了几个js代码片段，觉得很有意思，其中考察了关于<code>setTimeout</code>、<code>函数闭包</code>、<code>IIFE（立即执行函数表达式）</code>、<code>promise</code>、<code>js解释器</code>等概念的理解</p>
<p>A：下面的程序输出啥？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我：没有坑，别想多了。输出<code>0 1 2 3 4</code></p>
<p>A：恩，那下面这个呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;, <span class="number">1000</span>*i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我：<code>settimeout</code>时间到后，会在下一个tick中执行程序，所以程序打印的时候，i已经变成5了，输出<code>5 5 5 5 5</code>。</p>
<p>A：不错，那我想输出的结果是<code>0 1 2 3 4</code>，应该怎么办呢？</p>
<p>我：用闭包就解决了，如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;, <span class="number">1000</span>*i);</span><br><span class="line">    &#125;)(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为函数作用域内，保存着对于变量i的引用，故函数执行的时候仍能访问到当初的i。</p>
<p>A：很好。那如果去掉参数i呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;, <span class="number">1000</span>*i);</span><br><span class="line">    &#125;)(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我：这样的话，函数闭包内没有存储对i保持引用，所以输出结果又会变成<code>5 5 5 5 5</code></p>
<p>A： 对。那我再给你改一下程序，你看看输出啥？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//给setTimeout传递一个立即执行函数 </span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">     setTimeout((<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">         <span class="built_in">console</span>.log(i);</span><br><span class="line">     &#125;)(i), <span class="number">1000</span>*i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我：这里给<code>setTimeout</code>传递的是一个立即执行函数表达式，它会马上运行，执行结果是<code>undefined</code>，所以<code>setTimeout</code>输出0之后，应该会报错吧，因为参数传递不对，应该接受一个函数类型的参数。</p>
<p>上面的代码差不多等于：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//其实等价于</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">     setTimeout(<span class="literal">undefined</span>, <span class="number">1000</span>*i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A：恩！再看下面的这个程序输出什么？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> <span class="title">executor</span>(<span class="params">resolve</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">10000</span>;i++)&#123;</span><br><span class="line">        i == <span class="number">9999</span> &amp;&amp; resolve();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<p>我：思考半天…，应该输出<code>2 3 5 4 1</code>。这个题目是关于js解释器理解的。<code>setTimeout</code>中的函数会在下一个时钟周期运行，肯定比较靠后。<code>2，3</code>在立即执行函数中，所以他会立马打印。<code>4</code>在<code>then</code>中输出，它会放在当前周期的最后执行。最后<code>5</code>会立马打印。所以会这样<code>2 3 5 4 1</code>。</p>
<p>疑问：关于setTimeout和promise.then执行先后的问题，上网找了一下原因，setTimeout属于<code>Macrotask</code>，而promise属于<code>Microtask</code>，<code>Microtask</code>在当前周期队列执行，<code>Macrotask</code>在下一周期执行。</p>
<p>参考自：<a href="https://gold.xitu.io/entry/58b21e6c570c3500692805f1" target="_blank" rel="noopener">Excuse me？这个前端面试在搞事！</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/24/node版本管理 n和nvm说明/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/24/node版本管理 n和nvm说明/" itemprop="url">node版本管理 n和nvm说明</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-24T10:33:54+08:00">
                2017-02-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>项目中我们有时需要使用不同版本 的node来调试或测试程序，最本的方法当然是手动下载不同的版本，并卸载之前的版本，这样可以达到目的，但是无疑是麻烦时间的，在node中有“node版本管理器”来实现类似的功能需要。这里介绍比较流行的两个，“<code>n</code>”和“<code>nvm</code>”.<br>先说说n。<br>n是node一个模块，可以用来管理和切换node版本，其作者是TJ Holowaychuk（出名的Express框架作者），使用非常之简单。<br>安装 方法：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo npm install -g n</span><br></pre></td></tr></table></figure>
<p>常用命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$n</span> //查看已安装版本  </span><br><span class="line"><span class="variable">$n</span> latest  //安装最新版本并使用  </span><br><span class="line"><span class="variable">$n</span> latest -d   //下载最新版但不使用，-d参数表示为仅下载  </span><br><span class="line"><span class="variable">$n</span> stable  //安装最新稳定版本并使用  </span><br><span class="line"><span class="variable">$n</span> &lt;version&gt;  //安装某个版本并使用，如<span class="variable">$n</span> 6.2.2  </span><br><span class="line"><span class="variable">$n</span> rm &lt;version ...&gt; //删除某些版本  </span><br><span class="line"><span class="variable">$n</span> ls    //查看可用版本  </span><br><span class="line"><span class="variable">$n</span> --latest    //查看最新版本  </span><br><span class="line"><span class="variable">$n</span> --stable    //查看最新稳定版  </span><br><span class="line"><span class="variable">$n</span> -h    //查看帮助信息，更多命令在这里查看  </span><br><span class="line">[plain] view plain copy <span class="built_in">print</span>?在CODE上查看代码片派生到我的代码片</span><br><span class="line">$ n use 0.10.21 some.js   //&lt;span style=<span class="string">"font-family: Arial, Helvetica, sans-serif;"</span>&gt;以指定的版本来执行脚本&lt;/span&gt;</span><br></pre></td></tr></table></figure>
<p>下面说说<code>nvm</code>。<br>问题来了，既然有这么简单好用的n，那么nvm为什么还会大肆流行呢？这个问题一会回答，先说说nvm。<br>nvm全称Node Version Manager，不同于 n，nvm 不是一个 npm package，而是一个独立软件包。这意味着我们需要单独使用它的安装逻辑：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ wget -qO- https://raw.github.com/creationix/nvm/v0.4.0/install.sh | sh </span><br><span class="line">``` </span><br><span class="line">独立的安装包，因此当你机器上没有安装node时仍可以使用它。</span><br><span class="line">常用命令：</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">$ nvm install 0.10    </span><br><span class="line">$ nvm use 0.10         //使用指定的版本   </span><br><span class="line">$ nvm ls               //查看当前已经安装的版本  </span><br><span class="line">.nvm  </span><br><span class="line">-&gt;  v0.10.24  </span><br><span class="line">$ nvm current         //查看正在使用的版本  </span><br><span class="line">v0.10.24  </span><br><span class="line">$ nvm run 0.10.24 myApp.js      //以指定版本执行脚本  </span><br><span class="line">$ rm -rf ~/.nvm     //卸载nvm</span><br></pre></td></tr></table></figure>
<p>对比说明：<br>我们在使用 n 管理 node 版本前，首先需要一个 node 环境。我们或者用 Homebrew 来安装一个 node，或者从官网下载 pkg 来安装，总之我们得先自己装一个 node —— n 本身是没法给你装的。<br>然后我们可以使用 n 来安装不同版本的 node。<br>在安装的时候，n 会先将指定版本的 node 存储下来，然后将其复制到我们熟知的路径 /usr/local/bin，非常简单明了。当然由于 n 会操作到非用户目录，所以需要加 sudo 来执行命令。<br>两者区别:<br>安装简易度。nvm 安装起来显然是要麻烦不少；n 这种安装方式更符合 node 的惯性思维。见仁见智吧。<br>系统支持。注意， nvm 不支持 Windows。<br>对全局模块的管理。n 对全局模块毫无作为，因此有可能在切换了 node 版本后发生全局模块执行出错的问题；nvm 的全局模块存在于各自版本的沙箱中，切换版本后需要重新安装，不同版本间也不存在任何冲突。<br>关于 node 路径。n 是万年不变的 /usr/local/bin；nvm 需要手动指定路径。</p>
<p>参考地址：<br><a href="http://taobaofed.org/blog/2015/11/17/nvm-or-n/" target="_blank" rel="noopener">http://taobaofed.org/blog/2015/11/17/nvm-or-n/</a>     管理 node 版本，选择 nvm 还是 n？<br><a href="http://it.taocms.org/03/3079.htm" target="_blank" rel="noopener">http://it.taocms.org/03/3079.htm</a>      利用n和nvm管理Node的版本</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/22/Angular笔记 - 属性型指令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/22/Angular笔记 - 属性型指令/" itemprop="url">Angular笔记 - 属性型指令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-22T16:52:47+08:00">
                2017-02-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>属性型指令用于改变DOM元素的外观或行为。</p>
<p>在Angular中有三种类型的指令：</p>
<ol>
<li>组件 — 拥有模板的指令</li>
<li>属性型指令 — 改变元素外观或行为，例如内置的 <code>NgStyle</code> 指令可以同时修改元素的多个样式</li>
<li>结构型指令 — 通过添加和移除dom元素改变视图结构，例如，<code>NgFor</code> 和 <code>NgIf</code>。</li>
</ol>
<h2 id="一个简单的属性型指令"><a href="#一个简单的属性型指令" class="headerlink" title="一个简单的属性型指令"></a>一个简单的属性型指令</h2><p>我们这里实现了一个简单的属性型指令，说一下几个重点的内容</p>
<p>功能：当用户鼠标悬浮在元素上时，改变它的背景颜色</p>
<p>代码：</p>
<p>highlight.directive.ts</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Directive, ElementRef, HostListener, Input, Renderer &#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="meta">@Directive</span>(&#123;</span><br><span class="line">  selector: <span class="string">'[myHighlight]'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HighlightDirective &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> el: ElementRef, <span class="keyword">private</span> renderer: Renderer</span>) &#123; &#125;</span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">'mouseenter'</span>) onMouseEnter() &#123;</span><br><span class="line">    <span class="keyword">this</span>.highlight(<span class="string">'yellow'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">'mouseleave'</span>) onMouseLeave() &#123;</span><br><span class="line">    <span class="keyword">this</span>.highlight(<span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> highlight(color: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.renderer.setElementStyle(<span class="keyword">this</span>.el.nativeElement, <span class="string">'backgroundColor'</span>, color);  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>a.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>My First Attribute Directive<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">myHighlight</span>&gt;</span>Highlight me!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li><code>@Directive</code>装饰器需要一个 CSS 选择器，以便从模板中识别出关联到这个指令的 HTML，这里指令的选择器是<code>[myHighlight]</code>，Angular 将会在模板中找到所有带<code>myHighlight属性</code>的元素。</li>
<li>需要把 Angular 的<code>ElementRef</code>和<code>Renderer</code>注入进构造函数。<code>ElementRef</code>是一个服务，它赋予我们通过它的<code>nativeElement</code>属性直接访问 DOM 元素的能力。 <code>Renderer</code>服务允许通过代码设置元素的样式。</li>
<li>需要把这个类添加到 NgModule 元数据的<code>declarations数组</code>中</li>
</ul>
<blockquote>
<p>EXCEPTION: Template parse errors:<br>  Can’t bind to ‘myHighlight’ since it isn’t a known property of ‘p’.</p>
</blockquote>
<p>  错误原因:你记着设置<code>@NgModule</code>的<code>declarations数组</code>了吗？它很容易被忘掉</p>
<ul>
<li><code>@HostListener</code>装饰器引用属性型指令的宿主元素，在这个例子中就是<code>&lt;p&gt;</code></li>
</ul>
<h2 id="高级点的属性型指令"><a href="#高级点的属性型指令" class="headerlink" title="高级点的属性型指令"></a>高级点的属性型指令</h2><p>对上面的那个指令添加功能：</p>
<ol>
<li>通过绑定从外部设定这个颜色 </li>
<li>从外部设定一个默认颜色，如果没有传入颜色，则使用这个默认颜色</li>
<li><p>这样使用这个指令</p>
 <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> [<span class="attr">myHighlight</span>]=<span class="string">"color"</span> [<span class="attr">defaultColor</span>]=<span class="string">"'violet'"</span>&gt;</span></span><br><span class="line">    Highlight me too!</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>代码：</p>
<p>highlight.directive.ts</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Directive, ElementRef, HostListener, Input, Renderer &#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="meta">@Directive</span>(&#123;</span><br><span class="line">  selector: <span class="string">'[myHighlight]'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HighlightDirective &#123;</span><br><span class="line">  <span class="keyword">private</span> _defaultColor = <span class="string">'red'</span>;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> el: ElementRef, <span class="keyword">private</span> renderer: Renderer</span>) &#123; &#125;</span><br><span class="line">  <span class="meta">@Input</span>() <span class="keyword">set</span> defaultColor(colorName: <span class="built_in">string</span>)&#123;</span><br><span class="line">    <span class="keyword">this</span>._defaultColor = colorName || <span class="keyword">this</span>._defaultColor;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Input</span>(<span class="string">'myHighlight'</span>) highlightColor: <span class="built_in">string</span>;</span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">'mouseenter'</span>) onMouseEnter() &#123;</span><br><span class="line">    <span class="keyword">this</span>.highlight(<span class="keyword">this</span>.highlightColor || <span class="keyword">this</span>._defaultColor);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">'mouseleave'</span>) onMouseLeave() &#123;</span><br><span class="line">    <span class="keyword">this</span>.highlight(<span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> highlight(color: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.renderer.setElementStyle(<span class="keyword">this</span>.el.nativeElement, <span class="string">'backgroundColor'</span>, color);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>a.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"colors"</span> (<span class="attr">click</span>)=<span class="string">"color='lightgreen'"</span>&gt;</span>Green</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"colors"</span> (<span class="attr">click</span>)=<span class="string">"color='yellow'"</span>&gt;</span>Yellow</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"colors"</span> (<span class="attr">click</span>)=<span class="string">"color='cyan'"</span>&gt;</span>Cyan</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> [<span class="attr">myHighlight</span>]=<span class="string">"color"</span>&gt;</span>Highlight me!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> [<span class="attr">myHighlight</span>]=<span class="string">"color"</span> [<span class="attr">defaultColor</span>]=<span class="string">"'violet'"</span>&gt;</span></span><br><span class="line">  Highlight me too!</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>新的<code>highlightColor</code>属性被称为输入属性，因为数据是从绑定表达式流入指令中。 注意，在定义这个属性的时候，我们调用了<code>@Input()</code>装饰器，<code>@Input</code>向类添加元数据，使<code>highlightColor</code>属性能以<code>myHighlight</code>为别名进行绑定</li>
<li>你可以通过重命名属性名到myHighlight来移除这个区别，像这样：<code>@Input() myHighlight: string;</code></li>
<li><code>defaultColor</code>属性是一个 <code>setter</code> 函数，它代替了硬编码的默认颜色 “red”,它不需要 getter 函数。这里，把字符串字面量<code>&#39;violet&#39;</code>绑定到了<code>defaultColor</code>上。</li>
</ul>
<h2 id="关于-输入属性的源和目标"><a href="#关于-输入属性的源和目标" class="headerlink" title="关于 输入属性的源和目标"></a>关于 输入属性的源和目标</h2><p>Angular 在绑定的源和目标之间的区别：</p>
<ul>
<li><p>如果属性出现在了模板表达式等号 (=) 的右侧，它就是一个<code>源</code>。</p>
</li>
<li><p>如果它出现在了方括号 ([ ]) 中，并且出现在等号 (=) 的左侧，它就是一个<code>目标</code>， 就像在绑定到HighlightDirective的myHighlight属性时所做的那样。</p>
</li>
</ul>
<p>例如：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> [<span class="attr">myHighlight</span>]=<span class="string">"color"</span>&gt;</span>Highlight me!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>[myHighlight]=&quot;color&quot;</code>中的 <code>&#39;color&#39;</code>是绑定源。 源属性不需要声明。</p>
<p><code>[myHighlight]=&quot;color&quot;</code>中的 <code>&#39;myHighlight&#39;</code> 是绑定目标。 必须把它定义为一个输入属性，否则，Angular 就会拒绝绑定，并给出一个明确的错误。</p>
<p>Angular 这样区别对待目标属性有充分的理由。 作为目标的组件或指令需要保护。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/22/TypeScript - 类/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/22/TypeScript - 类/" itemprop="url">TypeScript - 类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-22T16:04:45+08:00">
                2017-02-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="类"><a href="#类" class="headerlink" title="类"></a>类</h1><p> 从ECMAScript 2015，也就是ECMAScript 6开始，JavaScript程序员将能够使用基于类的面向对象的方式。 使用TypeScript，我们允许开发者现在就使用这些特性，并且编译后的JavaScript可以在所有主流浏览器和平台上运行，而不需要等到下个JavaScript版本。</p>
<h2 id="创建一个类"><a href="#创建一个类" class="headerlink" title="创建一个类"></a>创建一个类</h2><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Greeter &#123;</span><br><span class="line">    greeting: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">message: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.greeting = message;</span><br><span class="line">    &#125;</span><br><span class="line">    greet() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello, "</span> + <span class="keyword">this</span>.greeting;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter = <span class="keyword">new</span> Greeter(<span class="string">"world"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><ul>
<li>使用<code>extend</code>关键字来创建子类</li>
<li>子类构造函数中使用<code>super()</code>，执行父类的构造方法</li>
</ul>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Animal &#123;</span><br><span class="line">    name:<span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">theName: <span class="built_in">string</span></span>) &#123; <span class="keyword">this</span>.name = theName; &#125;</span><br><span class="line">    move(distanceInMeters: <span class="built_in">number</span> = <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;this.name&#125;</span> moved <span class="subst">$&#123;distanceInMeters&#125;</span>m.`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Snake <span class="keyword">extends</span> Animal &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123; <span class="keyword">super</span>(name); &#125;</span><br><span class="line">    move(distanceInMeters = <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Slithering..."</span>);</span><br><span class="line">        <span class="keyword">super</span>.move(distanceInMeters);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Horse <span class="keyword">extends</span> Animal &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123; <span class="keyword">super</span>(name); &#125;</span><br><span class="line">    move(distanceInMeters = <span class="number">45</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Galloping..."</span>);</span><br><span class="line">        <span class="keyword">super</span>.move(distanceInMeters);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sam = <span class="keyword">new</span> Snake(<span class="string">"Sammy the Python"</span>);</span><br><span class="line"><span class="keyword">let</span> tom: Animal = <span class="keyword">new</span> Horse(<span class="string">"Tommy the Palomino"</span>);</span><br><span class="line"></span><br><span class="line">sam.move();</span><br><span class="line">tom.move(<span class="number">34</span>);</span><br></pre></td></tr></table></figure>
<h2 id="public、private、protected修饰符"><a href="#public、private、protected修饰符" class="headerlink" title="public、private、protected修饰符"></a>public、private、protected修饰符</h2><ul>
<li><p>在ts中，成员类型默认为<code>public</code></p>
</li>
<li><p>当成员被标记成<code>private</code>时，它就不能在声明它的类的外部访问</p>
</li>
<li><p><code>protected</code>修饰符与<code>private</code>修饰符的行为相似，但<strong><code>protected</code>成员在派生类中仍然可以访问</strong></p>
</li>
<li><p>构造函数可以被标记成<code>protected</code>，这是这个类不可以在类外进行实例化，但是能被继承并在子类中实例化。</p>
</li>
</ul>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Person &#123;</span><br><span class="line">   <span class="keyword">protected</span> name: <span class="built_in">string</span>;</span><br><span class="line">       <span class="keyword">protected</span> <span class="keyword">constructor</span>(<span class="params">theName: <span class="built_in">string</span></span>) &#123; <span class="keyword">this</span>.name = theName; &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// Employee can extend Person</span></span><br><span class="line">   <span class="keyword">class</span> Employee <span class="keyword">extends</span> Person &#123;</span><br><span class="line">       <span class="keyword">private</span> department: <span class="built_in">string</span>;</span><br><span class="line">   </span><br><span class="line">       <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span>, department: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">           <span class="keyword">super</span>(name);</span><br><span class="line">           <span class="keyword">this</span>.department = department;</span><br><span class="line">       &#125;</span><br><span class="line">   </span><br><span class="line">       <span class="keyword">public</span> getElevatorPitch() &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="string">`Hello, my name is <span class="subst">$&#123;this.name&#125;</span> and I work in <span class="subst">$&#123;this.department&#125;</span>.`</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">let</span> howard = <span class="keyword">new</span> Employee(<span class="string">"Howard"</span>, <span class="string">"Sales"</span>);</span><br><span class="line">   <span class="keyword">let</span> john = <span class="keyword">new</span> Person(<span class="string">"John"</span>); <span class="comment">// Error: The 'Person' constructor is protected</span></span><br></pre></td></tr></table></figure>
<h2 id="readonly修饰符"><a href="#readonly修饰符" class="headerlink" title="readonly修饰符"></a>readonly修饰符</h2><ul>
<li><code>readnoly</code>修饰符，设置属性为只读的</li>
<li>只读属性必须在声明时或构造函数里被初始化</li>
</ul>
<h2 id="参数属性"><a href="#参数属性" class="headerlink" title="参数属性"></a>参数属性</h2><p>使用参数属性可以方便地在一个地方创建并初始化一个成员,可以简化代码</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Animal &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> name: <span class="built_in">string</span></span>) &#123; &#125;</span><br><span class="line">    move(distanceInMeters: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面仅在构造函数里使用<code>private name: string</code>参数来创建和初始化name成员,把声明和赋值合并至一处。</p>
<p>等价于</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Animal &#123;</span><br><span class="line">    <span class="keyword">private</span> name:<span class="built_in">string</span></span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">theName: <span class="built_in">string</span></span>) &#123; </span><br><span class="line">        <span class="keyword">this</span>.name=theName;</span><br><span class="line">    &#125;</span><br><span class="line">    move(distanceInMeters: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="存取器-getters-setters"><a href="#存取器-getters-setters" class="headerlink" title="存取器 getters/setters"></a>存取器 getters/setters</h2><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Person&#123;</span><br><span class="line">    <span class="keyword">private</span> _name:<span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">get</span> name():<span class="built_in">string</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> name(name:<span class="built_in">string</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>._name=name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> Person();</span><br><span class="line">p.name=<span class="string">'tom'</span>;        <span class="comment">//调用set</span></span><br><span class="line"><span class="built_in">console</span>.log(p.name); <span class="comment">//调用get</span></span><br></pre></td></tr></table></figure>
<p>要注意几点：</p>
<ul>
<li>使用<code>tsc file.ts --target es5</code>编译，因为它只支持ECMAScript 5或更高</li>
<li>只带有 <code>get</code>不带有<code>set</code>的存取器自动被推断为readonly</li>
</ul>
<p>用在哪里？<br>可以用在存取时需要做一些额外操作，而不是直接赋值的地方。</p>
<h2 id="静态属性"><a href="#静态属性" class="headerlink" title="静态属性"></a>静态属性</h2><ul>
<li><code>static</code>可以创建类的静态成员，这些属性存在于类本身，而不是类的实例上</li>
<li>使用<code>类名.静态成员名</code>格式访问类的静态成员</li>
</ul>
<h2 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h2><ul>
<li>抽象类一般不会直接实例化，而是作为派生类的基类。</li>
<li>与接口不同的地方：抽象类可以包含成员的实现细节。</li>
<li><code>abstract</code>关键字是用于定义抽象类和在抽象类内部定义抽象方法。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> Animal &#123;</span><br><span class="line">    <span class="keyword">abstract</span> makeSound(): <span class="built_in">void</span>;</span><br><span class="line">    move(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'roaming the earch...'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：<br><strong>抽象类中的抽象方法不包含具体实现</strong>，而且<strong>它必须要在派生类中实现</strong></p>
<h2 id="高级技巧"><a href="#高级技巧" class="headerlink" title="高级技巧"></a>高级技巧</h2><h3 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h3><p>在创建ts的一个类时，声明了几个东西：</p>
<ul>
<li>类的<code>实例类型</code></li>
<li>创建了一个叫做<code>构造函数的值</code></li>
</ul>
<p>a.ts<br><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Greeter &#123;</span><br><span class="line">    greeting: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">message: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.greeting = message;</span><br><span class="line">    &#125;</span><br><span class="line">    greet() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello, "</span> + <span class="keyword">this</span>.greeting;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter: Greeter;</span><br><span class="line">greeter = <span class="keyword">new</span> Greeter(<span class="string">"world"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(greeter.greet());</span><br></pre></td></tr></table></figure></p>
<p>上面的代码使用<code>tsc a.ts</code> 编译后得到的js代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> Greeter = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Greeter</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.greeting = message;</span><br><span class="line">    &#125;</span><br><span class="line">    Greeter.prototype.greet = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello, "</span> + <span class="keyword">this</span>.greeting;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> Greeter;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter;</span><br><span class="line">greeter = <span class="keyword">new</span> Greeter(<span class="string">"world"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(greeter.greet());</span><br></pre></td></tr></table></figure>
<h3 id="把类当做接口使用"><a href="#把类当做接口使用" class="headerlink" title="把类当做接口使用"></a>把类当做接口使用</h3><p>类定义会创建两个东西：<code>类的实例类型</code>和<code>一个构造函数</code>。 因为<strong>类可以创建出类型</strong>，所以你能够在允许使用接口的地方使用类。</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Point &#123;</span><br><span class="line">    x: <span class="built_in">number</span>;</span><br><span class="line">    y: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Point3d <span class="keyword">extends</span> Point &#123;</span><br><span class="line">    z: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> point3d: Point3d = &#123;x: <span class="number">1</span>, y: <span class="number">2</span>, z: <span class="number">3</span>&#125;;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/21/天使时代 - 刘慈欣/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/21/天使时代 - 刘慈欣/" itemprop="url">天使时代 - 刘慈欣</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-21T16:28:34+08:00">
                2017-02-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/小说/" itemprop="url" rel="index">
                    <span itemprop="name">小说</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>天使时代</p>
<p>　　引子</p>
<p>　　对桑比亚国的攻击即将开始。</p>
<p>　　执行“第一伦理”行动的三个航空母舰战斗群到达非洲沿海已十多天了，这支舰队以林肯号航母战斗群为核心展开在海面上，如同大西洋上一盘威严的棋局。</p>
<p>　　此时天已经暗了下来，舰队的探照灯集中照亮了林肯号的飞行甲板，那里整齐地站列着上千名陆战队员和海军航空兵飞行员。站在队列最前面的是“第一伦理”行动的最高指挥官菲利克斯将军和林肯号的舰长布莱尔将军，前者身材欣长，一派学者风度，后者粗壮强悍，是一名典型的老水兵。在蒸汽弹射器的起点，面对队列站着一位身着黑色教袍的的随军牧师，他手捧《圣经》，诵起了为这次远征而作的祷词：“全能的主，我们来自文明的世界，一路上，我们看到了您是如何主宰大地、天空和海洋，以及这世界上的万物生灵，组成我们的每一个细胞都渗透着您的威严。现在，有魔鬼在这遥远的大陆上出现，企图取代您神圣的至高无上的权威，用它那肮脏的手拨动生命之弦。请赐予我们正义的利剑，扫除恶魔，以维护您的尊严与荣耀，阿门——”</p>
<p>　　他的声音在带有非洲大陆土腥味的海风中回荡，令所有的人沉浸在一种比脚下的大海更为深广的庄严与神圣感之中，在上空纷纷飞过的巡航导弹火流星般的光芒中，他们都躬下身来，用发自灵魂的虔诚和道：“阿门——”</p>
<p>　　上篇</p>
<p>　　自人类基因组测序完成以后，人们就知道飞速发展的分子生物学带来的危机迟早会出现，联合国生物安全理事会就是为了预防这种危机而成立的。生物安理会是与已有的安理会具有同等权威的机构，它审查全世界生物学的所有重大研究课题，以确定这项研究是否合法，并进而投票决定是否终止它。</p>
<p>　　今天将召开生物安理会第119次例会，接受桑比亚国的申请，审查该国提交的一项基因工程的成果。按照惯例，申请国在申请时并不提及成果的内容，只在会议开始后才公布。这就带来一个问题：许多由小国提交的成果在会议一开始就发现根本达不到审查的等级。但各成员国的代表们都不敢轻视这个非洲最贫穷的国度提交的东西，因为这项研究是由诺贝尔奖获得者，基因软件工程学的创始人依塔博士做出的。</p>
<p>　　依塔博士走了进来，这位年过五十的黑人穿着桑比亚的民族服饰，那实际上就是一大块厚实的披布，他骨瘦如柴的身躯似乎连这块布的重量都经不起，像一根老树枝似的被压弯了。他更深地躬着腰，缓缓向圆桌的各个方向鞠躬，他的眼睛始终看着地面，动作慢地令人难以忍受，使这个过程持续了很长时间。印度代表低声地问旁边的美国代表：“您觉得他像谁？”美国代表说：“一个老佣人。”印度代表摇摇头，美国代表看了看他，又看了看依塔，“你是说……像甘地？哦，是的，真像。”</p>
<p>　　本届生物安理会轮值国主席站起来宣布会议开始，他请依塔在身旁就座后说：“依塔博士是我们大家都熟悉的人，虽然近年来深居简出，但科学界仍然没有忘记他。不过按惯例，我们还是对他进行一个简单的介绍。博士是桑比亚人，在三十二年前于麻省理工学院获计算机科学博士学位，而后回到祖国从事软件研究，但在十年后，突然转向分子生物学领域，并取得了众所周知的成就。”他转向依塔问，“博士，我有个问题，纯粹是出于好奇：您离开软件科学转向分子生物学，除了预见到软件工程学与基因工程的奇妙结合外，是不是还有另一层原因：对计算机技术能够给您的祖国带来的利益感到失望？”</p>
<p>　　“计算机是穷人的假上帝。”依塔缓缓地说，这是他进来后第一次开口。</p>
<p>　　“可以理解，虽然当时桑比亚政府在首都这样的大城市极力推行信息化，但这个国家的大部分地区还没有用上电。”</p>
<p>　　当分子生物学对生物大分子的操纵和解析技术达到一定高度时，这门学科就面对着它的终极目标：通过对基因的重新组合改变生物的性状，直到创造新生物。这时，这门科学将发生深刻变化，将由操纵巨量的分子变为操纵巨量的信息，这对于与数学仍有一定距离的传统分子生物学来说是极其困难的。直接操纵四种碱基来对基因进行编码，使其产生预期的生物体，就如同用0和1直接编程产生WINDOWSXP一样不可想象。依塔最早敏锐地意识到这一点，他深刻地揭示出了基因工程和软件工程共同的本质，把基础已经相当雄厚的软件工程学应用到分子生物学中。他首先发明了用于基因编程的宏汇编语言，接着创造了面向过程的基因高级编程语言，被称为“生命BASIC”；当面向对象的基因高级语言“伊甸园++”出现时，人类真的拥有了一双上帝之手。</p>
<p>　　这时，人们惊奇地发现，创造生命实际上就是编程序，上帝原来是个程序员。与此同时，程序员也成了上帝，这些原来混迹于硅谷或什么什么技术园区的的人纷纷混进生命科学行业来，他们都是些头发蓬乱衣冠不整的毛头小子，过着睡两天醒三天的日子，其中有许多人连有机物和无机物都分不清，但都是性能良好的编程机器。有一天，项目经理把一个光盘递给一位临时召来的这样的上帝，告诉他光盘中存有两个未编译的基因程序模块，让他给这两个模块编一个接口程序。谈好价钱后上帝拿着光盘回到他那间闷热的小阁楼中，在电脑前开始他那为期一周的创世工作，他干起活来与上帝没有任何共同之处，倒很像一个奴隶。一周后，他摇晃着从电脑前站起来，从驱动器中取出另一块拷好的光盘，趟着淹没小腿的烟蒂和速溶咖啡袋走出去，到那家生命科学公司把那个光盘交给项目经理。项目经理把光盘放入基因编译器中，在一个球形透明容器的中央，肉眼看不见的分子探针精巧地拨弄着几个植物细胞的染色体。然后，这些细胞被放入一个试管的营养液中培养，直至其长成一束小小的植株，后来这个植株被放入无土栽培车间，长成树苗后再被种进一个热带种植园，最后长成了一棵香蕉树。当第一串沉重的果实从树上砍下后，你掰下一个香蕉剥开来，发现里面是一个硕大的橘瓣……</p>
<p>　　当然，以上只是一个生动的比喻，实际的基因软件开发都是庞大的工程，绝非个人的力量所能及。例如仅编制一个视网膜感光细胞的基因软件，其代码量与一个最新的视窗操作系统相当。所以完全凭借基因编程创造新的生命还只能是病毒级别，科学家们倾向于从生物的自然基因中分离出各种功能模块和函数，通过引用和组合这些模块和函数来得到具有新的特征的生物，对此，面向对象的基因编程语言“伊甸园++”是一个强有力的工具。</p>
<p>　　“依塔博士，在宣布会议议程正式开始之前，我想提醒您：您看上去很虚弱。”会议主席关切地对依塔说。</p>
<p>　　一位桑比亚官员起身说：“各位，依塔博士每天吃得很少，你们一定知道，桑比亚国内目前正面临着严重的旱灾，博士自愿同他的人民一同挨饿。”</p>
<p>　　法国代表说：“上个月，作为发展计划署考察团的一员，我到过桑比亚和相临的其它两个受灾国家，那里的旱情确实可怕，如果大量的救济不能及时到位，下半年会饿死很多人的。”</p>
<p>　　“不过，依塔博士，”美国代表说，“作为一位从事基础研究的科学家，过分的责任心会影响您的研究，结果反而不能够尽到自己的责任。”</p>
<p>　　依塔点点头，并半起身冲他微微鞠躬：“您说得很对，唉，小时侯留下来的毛病，很难改了……哦，各位想不想听听我小时侯的事情？”</p>
<p>　　这显然离题了，但出于尊敬，大家都没有出声。依塔用低缓的声音讲述起来，仿佛在回忆中自语。</p>
<p>　　“那也是一个大旱之年，大地像一个满是裂缝的火炉子，地上被渴死的蛇又被烈日烤干，脚一踏就碎成了末……当时桑比亚正在连年的内战中，就是那场由东方政治集团操纵的推翻布萨诺政权的战争。我们的村子被遗弃了，什么吃的都没有了，雅拉就去吃干草和树叶，哦，雅拉是我的小妹妹，刚懂事，大大的眼睛……她去吃干草和树叶……”依塔的声音平缓而单调，像是早期的语音软件在读一个文本文件，“她吃得浑身浮肿，肠道也堵塞了……那天晚上，她嘴里含了什么东西，碰着牙喀啦啦响，我问她含着什么？她说在吃糖……她以前只吃过一块糖，是一年前一个来村里招募游击队员的苏联顾问给的。我看到一道血从她嘴里流出来，就掰开她的嘴看，雅拉含的不是糖块，是一个箭头，一个涂着响尾蛇的毒液，用来射杀豺狗的箭头。她最后对我说：雅拉难受，雅拉不想再活了，雅拉死后哥哥把雅拉吃了吧，然后哥哥就有劲儿走到城里去，听说那里有吃的…</p>
<p>　　…我还记得那天晚上的月亮，从干旱的大地尽头升起来，昏红昏红的……我没吃小妹妹，但那年在村子里，确实发生了人吃人的事，有些老人立下遗嘱，饿死后让孩子们吃……“</p>
<p>　　全场陷入长长的沉默。</p>
<p>　　主席说：“博士，我们现在理解了你在过去十多年用基因软件技术改良农作物的努力。”</p>
<p>　　“一事无成，一事无成啊……”依塔摇头叹息，“想当初桑比亚独立之时，我们曾想在祖先的土地上建起天堂，但后来知道，在这样一块苦难深重的土地上，对生活的期望是不能太高的。我们理想的底线在不断后退，我们不要工业化了，我们不要民主了，我们甚至可能连国家和个人的尊严都不要了，但桑比亚人对生活的要求不可能再后退，我们不能不吃饭。这个国家仍然有三分之二的人在挨饿，我们必须想出办法。”</p>
<p>　　依塔的话在会场里引起了很大的反响，代表们纷纷低声议论起来。</p>
<p>　　美国代表说：“非洲确实是一个被文明进程抛下的大陆，但，博士，这是一个涉及到社会政治、历史、地理条件等诸多复杂因素的问题，不是科学家们仅凭手中的科学就能够解决的。”</p>
<p>　　依塔摇摇头说：“不，科学也许真能解决饥饿问题，关键在于我们要换一个思考方向。”</p>
<p>　　代表们茫然地互相对视着，主席首先想到了什么，说：“如果我没理解错，依塔博士已经开始了我们这次会议的议程了。”</p>
<p>　　依塔郑重地说：“是的，主席先生，如果您允许，在介绍我们的研究成果前，我想先让各位认识一个孩子，一个能吃饱饭的桑比亚孩子。”</p>
<p>　　他挥挥手，一个黑人男孩儿走进会议大厅。他赤裸着上身，肌肉饱满，皮肤光亮，浓密卷鬈发下的一双大眼睛闪闪有神，他用强健而轻快的脚步，把一股旺盛的生命力带进了会议大厅。</p>
<p>　　“哇，好一个小奥塞罗！”有人赞叹道。</p>
<p>　　依塔介绍说：“这是卡多，十二岁，一个土生土长的桑比亚孩子。当然，在平均寿命只有四十多岁的赞比亚，他这样的年纪通常已经不算是孩子了，但卡多确实是孩子，而且是个小孩子，因为他的寿命肯定要超过我们在座的各位。”</p>
<p>　　“这不奇怪，看得出来这孩子的营养状况很好。”代表中的一位医学家说。</p>
<p>　　依塔扶着卡多的双肩环视着会场说：“他肯定与各位印象中的桑比亚儿童有很大差别，那些饥饿中的孩子都是细细的脖颈撑着大大的脑袋，四肢像树干般枯瘦，肚子因积水而鼓起，脸上落着苍蝇，身上生着疮……所以大家都看到了。只要吃饱了饭，任何民族的孩子都能变得像天使般高贵。”</p>
<p>　　卡多向大家点头致意，大声说了一句谁都听不懂的话。</p>
<p>　　“他在向各位问好，”依塔说，“卡多只会讲桑比亚语。”</p>
<p>　　“您刚才说，这孩子是在桑比亚土生土长的？”主席问。</p>
<p>　　“是的，而且是在桑比亚最贫瘠的地区长大，从未离开那里。在这场旱灾中，他的家乡饿死了不少人。”</p>
<p>　　所有人都目不转睛地盯着这个健壮的黑孩子，一时谁也说不出话来。</p>
<p>　　依塔第一次露出了淡淡的微笑：“大家的下一个问题自然是：他在那里吃什么？那么下面，我就请大家看卡多吃一顿午餐。”</p>
<p>　　他说完又向门的方向挥了一下手，有三个人走进会议大厅，其中两位是参加会议的桑比亚官员，第三个人令大家大吃一惊，他竟是一名纽约警察。他腰上累赘地别着手枪、警棍、对讲机等等，手里提着一个大塑料袋，进门后犹豫地站住了。</p>
<p>　　“是我们请这位警官进入会场的。”依塔对主席说，主席示意让那名警察走上前来。</p>
<p>　　警察走到圆桌旁，两位代表给他让开了位置，他把大塑料袋中的东西都倾倒在桌面上，首先倒出的是一大捆青草，然后是一堆梧桐树叶，最后是一堆深绿色的松针。警察指指这堆青草和树叶，又指指同他一起进来的那两名赞比亚官员说：“这两位先生在庭院里的草坪上拔草，我去制止他们，他们就把我带到这里来了。”</p>
<p>　　依塔起身向警察鞠躬：“尊敬的警官先生，我对我们的粗鲁行为表示歉意，并愿意交纳相应的罚款，我们只是想请你来做个证明，证明这些青草和树叶是真实的。”</p>
<p>　　警察瞪大双眼说：“当然是真实的！是我把它们收集到袋子里一直提到这里的。”</p>
<p>　　依塔点点头：“好吧，卡多该用他的午餐了。”</p>
<p>　　这个桑比亚孩子抓起一大把青草，卷成粗绳壮的一根，像吃香肠那样咬下一大截，津津有味地嚼了起来，草茎被嚼碎时发出的吱吱声清晰可闻……他吃得很快，转眼把那粗粗的一把草吃光了，又开始大口吃树叶……</p>
<p>　　旁观者的反应分为两类：一部分人极力忍住呕吐的欲望，另一部分人则抑制不住开始咽口水，这是在看到别人享用他感觉中的美味时的一种自然条件反射，不管那美味是什么。</p>
<p>　　卡多又卷了一把草吃，然后开始吃松针，他咀嚼的声音立刻发生了变化，一道墨绿色的汁液顺着他的嘴角流下来，他含着满嘴的松针和青草，高兴地对依塔说了句什么。</p>
<p>　　“卡多说这里的草和树叶比桑比亚的味道好。”依塔解释说，“由于盲目引进高污染的工业，桑比亚已经成了西方的垃圾倾倒场，那里的环境污染比这里要严重得多。”</p>
<p>　　在众目睽睽之下，卡多吃光了桌子上所有的青草、梧桐叶和松针，他满意地抹去嘴角的绿色汁液，笑着对依塔点点头，显然是在感谢这顿美味的午餐。</p>
<p>　　用后来一位记者的描述，会议大厅陷入“地狱般的寂静”。不知过了多长时间，这寂静才被主席颤抖的声音打破。</p>
<p>　　“这么说，依塔博士，这就是您代表桑比亚国提交生物安全理事会审查的研究成果了？”</p>
<p>　　依塔镇静地点点头：“是的，这就是我刚才说过的换一个思考方向：我们既然可以用基因工程来改造农作物，为什么不能用它来改造人自身呢？比如说这个桑比亚孩子，他的消化系统经过了重新编程，使他的食物范围大大扩展。对于这样的新人类，农作物完全可以改种一些速生或抗旱的植物，那些以前让我们头疼的疯长的野草对他们来说就是万倾良田。即使是种植传统作物，他们从土地中收获的粮食也要比我们多十倍，比如对于小麦来说，麦秸秆甚至根系他们都能食用。粮食对于他们，将真的如空气和阳光一样随手可得了。”</p>
<p>　　各国代表都如石雕般站在大圆桌旁，把阴沉的目光聚焦到依塔身上，依塔坦然地承受着这些目光，平静地说：“尊敬的各位先生，我向联合国转达鲁维加总统的话：桑比亚已准备好为此承受一切。”</p>
<p>　　主席首先从呆立的状态中恢复过来，撑着桌沿小心地坐下，好像他已虚弱得站立不稳似的，他两眼平视前方说：“您刚才好像说过，这孩子十二岁？”</p>
<p>　　依塔点点头。</p>
<p>　　“这么说，你们十二年前就对人类基因重新编程了？”</p>
<p>　　“确切地说应该是十五年前，第一批编程是使用基因汇编语言进行的，半年后，编程工具改用面向过程的高级语言‘BASIC’。至于卡多，是用面向对象的‘伊甸园++’编程，这是三年以后的事了。我们从食草动物中提取了大量的消化系统的函数和子模块，去掉了反刍部分，经过优化和组合后植入人类的受精卵的基因编码中，但其中有许多程序，比如胃液的成分、胃壁的强度和肠道蠕动方式等，没有借用任何自然代码，纯粹是我们自行编制开发的。”</p>
<p>　　“依塔博士，我们最后想知道，在桑比亚，经过重新编程的人类有多少？”</p>
<p>　　“卡多这一批只有不到一百人，因为我们对面向对象的编程方式还没有十分把握。重新编程的桑比亚人只要是十五年前那两批，使用宏汇编语言和‘生命BASIC’编程的受精卵共有两万一千零四十三个，其中两万零八百一十六个成活并正常分娩。”</p>
<p>　　哗啦一声，上届诺贝尔生物学奖获得者，法国生物学家弗朗西丝女士晕倒了。她旁边的另一位诺贝尔奖获得者，德国生理学家，本届生物安理会轮值副主席施道芬格博士脸色发紫呼吸急促，正闭着眼从胸前的衣袋中摸索硝化甘油片。只有美国代表很镇静，他指着依塔，转身对那个仍然目瞪口呆的警察说：“逮捕他。”</p>
<p>　　他说得很平静，像是朝人借个火儿，看到那个警察茫然不知所措，他平静的薄纱立刻被摧毁了，如火山爆发般咆哮起来：“听到了吗？逮捕他！别管什么辖免权，那是对人的，不是对魔鬼！”</p>
<p>　　主席站起身，试图使美国代表平静下来，然后转向依塔，眼里含着悲愤的泪水说：“博士，您和您的国家可以违反联合国生物安全条约的最高禁令，对人类基因进行重新编程，但你们不该如此猖狂，竟到这个神圣的地方来向全人类的脸上泼粪！你们违反了第一伦理，你们抽掉了人类文明的基石！”</p>
<p>　　“人类文明的基石是有饭吃，桑比亚人只是想吃饱饭。”依塔向主席鞠了一躬，以他特有的缓慢语调说。</p>
<p>　　“好了，我们还是散会吧。”美国代表对主席一挥手说，这时他真的平静下来了，“其实大家早就预料到这事迟早会发生，早些比晚些好。我想各位都知道我们该去做什么了，至少美国知道，我们要赶快去做了！”说完他匆匆而去。</p>
<p>　　会议大厅中人们相继走散，最后只剩下依塔和卡多，还有那个警察。依塔搂着卡多的双肩向门口走去，警察阴沉地盯着孩子的背影，一手摸着屁股上的短管左轮低声说：“真该崩了这个小怪物。”</p>
<p>　　消息传出，举世震惊。</p>
<p>　　第二天，世界各大媒体上都出现了依塔和卡多的图像和照片。依塔用枯枝般的双臂把卡多紧紧搂在他那枯枝般的身躯上，眼睛总是看着地面，而那个黑孩子则强壮剽悍，两眼放光，与依塔形成鲜明对比。两人融为一体，形成了一个不规则的黑色构图，真是活脱脱的一对魔鬼。</p>
<p>　　在以后桑比亚代表团逗留美国的两天里，世界各国要求就地逮捕他们的呼声日益高涨，联合国大厦前每天都有人山人海的抗议游行队伍。社会上对桑比亚代表团，特别是依塔和卡多两人的人身威胁层出不穷，但美国政府表现得十分克制，只宣布将代表团驱逐出境。</p>
<p>　　这两天，依塔不分昼夜地紧紧搂着小卡多，在公共场合他的眼睛总是看着地面。但正如有记者描述，他有着“魔鬼的灵敏”，周围一有风吹草动，他立刻把孩子护到身后，并抬头凝视着异常出现的方向。他的眼窝很深，整个眼睛都隐没于黑暗中。活脱脱的魔鬼！</p>
<p>　　桑比亚政府提出用专机接代表团回国，但美国政府不准桑比亚的飞机入境，别国又不肯租给他们飞机，只好乘欧洲的一架客机。为了安全，桑比亚政府买下了一等舱的全部机票。</p>
<p>　　当桑比亚代表团登上飞机，依塔搂着卡多首先走进空荡荡的一等舱时，他长长地松了一口气，紧搂着卡多的手放松了些。在他们登机时，空中小姐表现出遇到魔鬼时理所当然的反应：满脸恐惧地避得远远的，只有一位欧洲空姐勇敢地领着他们进一等舱。这位金发碧眼的姑娘美丽动人，脸上露着真诚的微笑，温暖了桑比亚人那已凉透了的心。在走出机舱前，她双手合十，用不知从哪里学来的东方礼仪向孩子默默祝福，一时让旁边的桑比亚人的眼睛都湿润了。</p>
<p>　　然后，她掏出手枪，紧贴孩子的头部开了两枪。</p>
<p>　　与后来的传说不同，黛丽丝绝对不是美国政府或其它什么国家派来的杀手，她的谋杀完全是个人行为。事实上，在桑比亚代表团留美期间，美国政府对他们是采取了严密的保护措施的，文明世界要对付的是整个桑比亚国，这之前不想横生枝节，但这最后一击实在是防不胜防。班机上的空姐们都配有反劫机手枪，发射不会破坏机舱的橡木弹头，一般来说被击中后不会致命，但黛丽丝是贴着孩子的两眼开枪的。</p>
<p>　　“我没有杀人，哈哈，我没有杀人！哈哈哈！”黛丽丝开枪后挥着沾满鲜血的双手歇斯底里地欢呼着。</p>
<p>　　依塔抱着卡多的尸体，眼睛仍看着地面，一直等到黛丽丝安静下来。她把血淋淋的手指咬在嘴里，用疯狂的目光盯着依塔，一时间机舱里死一般寂静，只有孩子头部流出鲜血的汩汩声。</p>
<p>　　“姑娘，他是人，他是我的孙子，一个能吃饱饭的孩子。”</p>
<p>　　黛丽丝在法庭上被判无罪，很快被媒体炒成捍卫人类尊严的英雄。</p>
<p>　　桑比亚代表团回国后的第二天，联合国向桑比亚政府发出最后通牒：交出境内所有生物学家和相应的技术人员，交出所有经过重新编程的个体，销毁所有基因工程设施，该国元首到特别法庭同其他主犯和从犯一起接受审判。</p>
<p>　　现在，全世界都小心地把那些基因被重新编程的桑比亚人称为“个体”。</p>
<p>　　桑比亚国拒绝了最后通牒，于是，为了维护人类神圣的第一伦理，文明世界向非洲开始了二十一世纪的十字军东征。</p>
<p>　　下篇</p>
<p>　　“您能不能停一会儿，我看着很累，您这么来回走了有一个多小时了。”布莱尔舰长说。</p>
<p>　　菲利克斯将军仍然以军人标准的步伐来回踱着：“在西点，这是教官惩罚学生的办法之一：让他在操场的一角来回走几个小时。久而久之，我喜欢上了这种惩罚，只要在这时我才能很好地思考。”</p>
<p>　　“这么说，您在西点是个不讨人喜欢的人。我在安纳波利斯海校却很讨人喜欢，那里也有这种惩罚，我一次也没受过，倒是在高年级时，我常用它来治那些刚进校的毛毛头。”</p>
<p>　　“世界任何一所军校都不喜欢爱思考的人，安纳波利斯不喜欢，西点不喜欢，圣西尔和伏龙芝都不喜欢。”</p>
<p>　　“是的，思考，特别是像您那样思考，对我是件很累的事。不过，我不认为这场战争有很多可以思考的东西。”</p>
<p>　　对桑比亚的“外科手术”已持续了二十多天，每天有上千架次的飞机狂轰滥炸，从舰载机上的激光智能炸弹攻击到从阿森松岛飞来的大型轰炸机的地毯式轰炸，还有巡洋舰和驱逐舰上大口径舰炮日夜不停的轰击，这个非洲穷国实在剩不下什么了。他们那只有二十几架老式米格机的空军和只有几艘俄制巡逻艇的的海军，在二十天前就被首批发射的巡航导弹在半小时内毁灭，而桑比亚陆军的二百多辆老式坦克和装甲车也在随后的两三天内被来自空中的打击消灭干净。</p>
<p>　　随后，攻击转向了桑比亚境内所有的车辆、道路和桥梁，而摧毁这些也用不了多长时间。</p>
<p>　　现在，桑比亚国已被打回到石器时代。</p>
<p>　　参加攻击的三个航母战斗群已撤走了两个，只留下林肯号战斗群完成“第一伦理”行动最后的使命。除了林肯号航母外，战斗群还包括一艘贝尔纳普级巡洋舰、两艘斯普鲁恩斯级驱逐舰、一艘孔兹级驱逐舰、两艘诺克斯级护卫舰、两艘佩里级护卫舰、一艘威奇塔级补给舰，还有三艘看不见的“鲱鱼”级攻击潜艇。</p>
<p>　　菲利克斯将军突然从踱步中站住，看着布莱尔舰长，舰长很不舒服地想：这人确实像个学者，而且是神经衰弱的那种。</p>
<p>　　“我还是认为我们离海岸太近了。”菲利克斯说。</p>
<p>　　“这样我们可以向桑比亚人更有力地显示自己的存在。我不明白您担心什么。”舰长挥着雪茄说。</p>
<p>　　舰队，特别是林肯号确实能显示其存在。它是尼米兹级航母的第5艘，于1989年服役，排水量近十万吨，全长三百多米，有二十层楼高，是一座带来死亡的海上钢铁城市。</p>
<p>　　菲利克斯又接着踱起步来：“舰长，您清楚我的观点，我对现代化战争中航空母舰在海上的生存能力一直存有疑虑。在我的感觉中，航母总像是一只漂浮在海上的薄壳大鸡蛋，脆弱得很。”</p>
<p>　　“您也知道，在参联会和军备听证会上，我是一贯支持您的看法的。但现在，桑比亚军队拥有射程最远的武器可能就是55毫米的迫击炮了，如果有，它也只能藏在地窖里，拉出来十分钟内就会被摧毁……事实上，我也觉得这是一场无聊的战争，军队在精神上正在衰落，主要原因是缺少自己的英雄偶像。二十世纪后期的几场战争，都没有造就出像巴顿、麦克阿瑟、艾森豪威尔的英雄，因为敌手太弱了，这次也一样。”</p>
<p>　　这时，一名参谋递给菲利克斯一份电报，他看后喜上眉梢，这几乎是攻击开始后他第一次真正露出笑容。</p>
<p>　　“看来这一切都快结束了，桑比亚政府已接受了所有条件，他们将很快交出桑比亚境内所有生物学家和基因工程师，以及所有基因被重新编程的个体，在这一切都完成后，元首将本人将投案自首。”菲利克斯把电报递给布莱尔。</p>
<p>　　布莱尔看都没看就把电报扔到海图桌上：“我说过这是一场乏味的战争。”</p>
<p>　　两位将军透过他们所在的航母塔岛上的舰长室宽大的玻璃窗看到，一架海军陆战队的直升机从海岸方向飞来，降落到林肯号的甲板上。依塔一行几人从直升机上走下来，并在周围陆战队员的枪口下低头向塔岛走来。依塔走在最前面，他仍穿着那身民族服装，像一根披着一块大布的老树枝。</p>
<p>　　过了一会儿，这一行人走进塔岛，进入舰长室。除了依塔仍两眼朝下外，其他人都不由四下打量起来。如果只看四周，这里仿佛就是一间欧洲庄园的豪华餐厅，有着猩红色的地毯，华丽的镶木四壁上刻着浮雕，挂着反映舰长趣味的大幅现代派油画。但抬头一看，就会发现天花板是由错综复杂的管道组成的，这同周围形成了奇特的对比。高大的落地窗外，舰载飞机在不间断地呼啸着起降。</p>
<p>　　依塔博士没有抬头，向菲利克斯所在的方向微微弯了一下腰，用虚弱的声音缓缓说：“尊敬的将军，我带来了桑比亚国真诚的敬意，您率领的舰队那天神般的力量令我们胆寒，我们屈服认罪。”</p>
<p>　　菲利克斯将军说：“博士，我希望您真的明白你们在做什么。”</p>
<p>　　“我们明白，在文明世界的上帝面前我们跪下，我们认罪，但将军，人要是饿得厉害，就顾不得什么廉耻了。”依塔深深地鞠躬说。</p>
<p>　　周围一群年轻的参谋都用鄙夷的目光看着面前这根老干柴。“博士？”一直没说话的布莱尔舰长喊了一声，依塔微微抬头，被舰长呸的一口吐在脸上，他仍石雕般一动不动地立着，任白色的唾液顺着他那深纹密布的脸流到纷乱的胡子上。</p>
<p>　　菲利克斯惋惜地摇摇头：“您本来可以不挨饿的，留在文明世界，您有可能再获得一次诺贝尔奖，却去为一个连人类最起码的伦理都不顾的极权政府工作。”</p>
<p>　　“我为桑比亚人民工作。”依塔又鞠了一躬。</p>
<p>　　“你给桑比亚人民带来了灾难。”菲利克斯说。</p>
<p>　　“不管这场灾难是谁带来的，将军，鲁维加总统都殷切希望它快些结束。为表达这个和平的心愿，国王还给将军带来了一件小小的礼物。”</p>
<p>　　依塔说完，从后面的一个人手中拿过了一个鸟笼大小的木笼子，依塔把笼子放到地毯上，轻轻打开笼门，一个雪白的小动物跑了出来，舰长室中的所有军人发出一阵惊叹声。那是一匹小马！它只有小猫大小，但在地毯上奔跑起来矫健灵活，雪白的鬃毛在飘荡，明亮有神的眼睛惊奇地看着这个世界，然后发出了一声清脆悠扬的嘶鸣。更奇怪的是，小马居然长着一对雪白的翅膀！</p>
<p>　　他们仿佛看到了从童话中跑出来的精灵！</p>
<p>　　“啊，太美了！我想这是您的基因软件的杰作吧？”菲利克斯惊喜地问。</p>
<p>　　依塔又微微鞠了一下身回答：“这是马和鸽子的基因组合体。”</p>
<p>　　“它能飞吗？”</p>
<p>　　“不能，它的翅膀没那么大力量。”</p>
<p>　　菲利克斯说：“博士，我代表贝纳感谢您，哦，贝纳是我的十二岁的小孙女，她为这礼物一定会高兴得发狂的！”</p>
<p>　　“祝她幸福美丽，也祝未来的桑比亚孩子有他十分之一的幸运，十分之一就足够了，将军。”</p>
<p>　　以后三天，大批的运输直升机频繁往返于桑比亚的内陆和沿海之间，从内地运来大批桑比亚政府交出的经过基因编程的“个体”，他们都是十五岁的黑人，绝大部分是男性。这些人被装上等候在沿海的运输船和登陆艇，每艘船装满后立刻向远海驶去。</p>
<p>　　由于收到了中央情报局的一份紧急情报，菲利克斯将军决定再次召见伊塔。伊塔走进舰长室后，立刻目不转睛地看着窗外，在不远的海面上，几架体形庞大的支奴干运输直升机正悬停在一艘运输舰上方，黝黑的“个体”不停地从机舱中爬出，顺着软梯下到戒备森严的甲板上，然后在持枪士兵的推搡下进入舱里。</p>
<p>　　菲利克斯来到伊塔身边，同他一起看着海上的情景，“这是最后几船了，三天运走了两万个个体。”</p>
<p>　　“他们要被送到哪里？”伊塔问。</p>
<p>　　“博士，这不是你我需要关心的事情。”菲利克斯冷冷地说。</p>
<p>　　“我们所在的这艘大船叫林肯号是吗？”伊塔突然问，菲利克斯茫然地点点头。“怎么会叫这个名字呢？上上个世纪，非洲的黑奴就是这么被运走的，他们的基因并没有经过重新编程。”</p>
<p>　　菲利克斯笑着摇摇头：“这是两回事，博士。我可以许诺，当这些个体还在我的管辖范围内时尽可能得到人道的待遇，就是野生动物也应该受到保护的，但仅此而已，他们以后的命运与我无关，与您也没有关系了。”</p>
<p>　　看到伊塔沉默无语，菲利克斯接着说：“那么，我们谈正事吧。博士，我知道那些个体比正常人要健康得多，但他们有时也会得一些正常人不会得的病，比如前不久，在个体中传染一种皮肤病，虽不会致命，但患者十分痛苦。为了制止这种病的传染，你们研制了一种接种疫苗，委托欧洲的一家制药公司生产，据我所知，已交货的疫苗总量够四万个个体用的。”</p>
<p>　　菲利克斯注意到伊塔掩着披布的一只手难以觉察地抖动了一下，但说话的声调仍是那么沉缓：“只有两万余名个体，将军。”</p>
<p>　　菲利克斯点点头：“我愿意相信，博士，只是有一个小小的要求：能把那剩下的两万份疫苗让我们看一下吗？只是看一下，我们不带走，它们对正常人没用。”</p>
<p>　　伊塔不说话。</p>
<p>　　“您是想说，它们在轰炸中毁了吗？”</p>
<p>　　伊塔缓缓地摇摇头：“不，那些疫苗都用完了。将军，我清楚您已经什么都知道了。”</p>
<p>　　“是的博士，您撒了谎：十五年前重新编程的受精卵不是两万个个体！立刻把他们交出来。”</p>
<p>　　伊塔把枯瘦的身体转向菲利克斯，眼睛仍然看着下方，这使人觉得他像一个人盲人，他说：“将军，在我的感觉中，您是一个明白人。”</p>
<p>　　菲利克斯双眉一挑问：“哦，在哪些方面？”</p>
<p>　　“很多方面，比如，您真是以一个十字军骑士的激情来领导这场战争吗？”</p>
<p>　　菲利克斯摇摇头：“不，我是以很理性的态度来对待自己的使命的，对于国际社会在这件事情上的大惊小怪，我觉得多少是一种矫情。”</p>
<p>　　伊塔无动于衷，倒是旁边的布莱尔舰长把目光从伊塔移到菲利克斯身上，吃惊地盯着他：“将军……”</p>
<p>　　“随着本世纪头二十年基因工程突飞猛进的发展，人类社会的宗教情绪也与日俱增，表面看来这是对生命伦理的崇敬和维护，其实是人类在使其茫然的技术社会中试图找到一种精神依托的表现。”</p>
<p>　　布莱尔大叫起来：“怎么能这样说将军？您应该知道，对人类基因的重新编程等于把人类置于与他自己可以随意制造的机器一样的地位，这将摧毁现代文明的整个法制和伦理体系基础！”</p>
<p>　　“您把电视上的话背得很熟，”菲利克斯不以为然地笑笑说，“但您所说的信仰和伦理体系是以西方基督教文化为基础的，而别的文化并不一定认同这种体系。在伊塔博士的非洲文化中，创世主的概念是很模糊的，比如马萨伊曾说：”当神着手准备开创世界时，他发现那里有了一只多洛勃（狩猎的部落），一头象和一条蛇。‘就是说人类和其它生命是先在的，是一种自发的创造物。对人为干预生命的进化，并没有西方基督教文化这么多的忌讳。就以西方文化本身来说，它的法制和伦理也不会因为对人类基因的重新编程而崩溃，事实上，为了更小的理由，我们早就在违反第一伦理，比如本世纪出现的克隆人，上世纪的试管婴儿，更早一些的时候，我们那些高贵的女士为了少一些麻烦和责任，并没有太多的犹豫就去流产和堕胎了。在这些事实面前，我们的法制和伦理体系好像也很现实地适应了，并没有丝毫崩溃的迹象。至于西方世界对在非洲发生的这件事这么大惊小怪，不过是因为我们不需要以野草和树叶充饥罢了。“</p>
<p>　　布莱尔目瞪口呆了好一会儿，迷惑地摇摇头。</p>
<p>　　菲利克斯对伊塔笑笑说：“别在意，博士，布莱尔舰长显然平时很少思考这类问题。”</p>
<p>　　“我的任务不是思考。”舰长气鼓鼓地说。</p>
<p>　　“菲利克斯将军是个明白人。”伊塔真诚地说。</p>
<p>　　“我已经足够坦率，那么请问博士，您是如何一眼把我看透的呢？”</p>
<p>　　“不是一眼，我们十多年前见过面，那是在麻省理工的一次鸡尾酒会上，你当时还是一名准将，在南卡罗来纳州的新兵训练营负责新兵训练工作。您说在现在的美国青年中，可以招到像科学家的士兵，像工程师的士兵，像艺术家的士兵，但像士兵的士兵却越来越难找了。接着你就说，基因工程有可能为美国创造出合格的士兵，这是军方人士第一次在这样的生物学家会上说这种话，因此我记住了您。”</p>
<p>　　“这真是一个好主意。”布莱尔舰长赞许地点点头。</p>
<p>　　“所以，舰长，只要有需要，伦理终究是第二位的。”菲利克斯对布莱尔说，极力掩盖自己的轻蔑。</p>
<p>　　“那么，将军，您一定理解我的恳求，求你们放过那两万个桑比亚人吧。”伊塔对“第一伦理”行动的指挥官连连鞠躬，看上去真像一个老乞丐。</p>
<p>　　菲利克斯坚定地摇摇头：“博士，我是军人，在执行使命，这与我对基因工程的看法没有关系。再说一遍：把那两万个个体交出来，即使您认为他们是桑比亚的未来。”</p>
<p>　　“将军，他们是全人类的未来。”</p>
<p>　　“这没有意义，我们不但确切地知道那两万个体的存在，甚至能猜到他们的隐藏之处，如果你们拒绝交出，我们只能轰炸那些丛林。”菲利克斯把手向下一劈说。</p>
<p>　　“知道怎样轰炸吗？”布莱尔把脸凑近伊塔说，“不是用林肯号上的飞机，它们太小了，是从阿松森基地飞来的巨型轰炸机，它们装满了燃烧弹，在那些丛林地带沿X形的对角线投弹，这样不管风向如何，都能形成一片完美的火场，其中的温度可以烧化桥梁，连细菌都活不下去。”</p>
<p>　　菲利克斯接着说：“怎么样博士，即使为了那些个体着想，也应该把它们交出来。”</p>
<p>　　伊塔用当地的土语哀叹了一句什么，整个身体像失去支撑似的摇摇欲坠。“给我电话，我向政府转达你们的意思。”</p>
<p>　　“很好，还要说明，不能用上次的移交方式，从内陆用直升机运送两万人太困难，在降落地点和途中还不时遭到游击队的袭击。我们要求你们把那两万个个体运到海岸来，就在这片沿海平地上，在舰队的火力控制范围内。以上的事完全由你们来做，然后我们用登陆艇一次性接收。”</p>
<p>　　“我转达。”伊塔无力地点点头。</p>
<p>　　当伊塔随着押解的陆战队员走到舰长室门口时，他突然转过身来，美国人惊奇地发现他的腰不驼了，现在站得挺直，这才可以看到他原来是那么高大的一个人。他那双隐没于眼窝中黑影中的眼睛，自那仿佛看不见底的黑潭中射出两道冷光，令在场所有人打了个寒战。</p>
<p>　　“离开非洲。”伊塔说。</p>
<p>　　“您说什么？”布莱尔舰长问。</p>
<p>　　伊塔没有理会，转身迈着大步走出去，那步伐之强健有力也与以前判若两人。</p>
<p>　　“他说什么？”布莱尔又转身问其他人。</p>
<p>　　“他让我们离开非洲。”菲利克斯说，双眼沉思地盯着伊塔离去的方向。</p>
<p>　　“他……哈……他真幽默！”布莱尔大笑起来。</p>
<p>　　入夜，在舰长室里，菲利克斯将军入神地看着桑比亚人送他的那匹小马，它正站在宽大的海图桌上，津津有味地吃着勤务兵刚送来的卷心菜。然后，他起身来到外面的舰桥上，凝视着远方的非洲海岸，一股热风吹到脸上，风中夹着烟味，远方的陆地笼罩在一片红光之中，那是桑比亚的城市在燃烧。火光映红了半边夜空，并在海水中反射，构成了一个虚假的黎明。</p>
<p>　　“将军，看得出您很忧虑。”布莱尔舰长也悄声来到舰桥上，在菲利克斯后面问。</p>
<p>　　“我们面对的，是一个被逼到墙角的民族。”菲利克斯看着燃烧的大陆说。</p>
<p>　　“那又怎么样？在这个世界上，鸡蛋就是鸡蛋，石头就是石头，我相信一切都会很顺利的。”</p>
<p>　　“但愿如此吧。四十多年前的那一天我记得很清楚，我和几名陆战队员一起守在西贡大使馆的楼顶，直升机正在运走最后一批人。文进勇将军指挥的北越军队离那儿只有几百米了，而美国在越南的势力范围，只剩大使馆楼顶这几十平方米了。一颗炮弹飞来，一名陆战队员被齐胸炸成两半，我还记得他的名字，他是最后一个死于越南的美国军人……那一时刻铭心刻骨，从此我明白了战争是一个很深奥的东西，谁都难以真正看透它。”</p>
<p>　　当菲利克斯被一名中校参谋叫醒时，天刚蒙蒙亮。参谋告诉他，指定的海岸地段已经集结了两万多桑比亚人，好像就是桑比亚政府交出的那两万个个体。</p>
<p>　　“不可能这么快的！”菲利克斯盯着参谋喊道，“他们靠什么集结？桑比亚大部分的公路和铁路都难以通行，就是有畅通的道路和足够的车辆也不可能这么快集结两万人！”</p>
<p>　　菲利克斯起身抓起一个望远镜，冲到舰桥上，清晨的海风让他打了一个寒战，舰桥上已站满了举着望远镜观察海岸的海军军官，布莱尔舰长也在其中。</p>
<p>　　向岸上望去，望远镜中出现的是从海岸伸延出去的广阔平原，燃烧的城市升起的烟雾如同平原后面一张巨大的黑灰色幕布。菲利克斯看到平原的地平线上有几个黑点，这些黑点渐渐变成了一条条黑线，很快，这些黑线连接起来，给地平线镶上了一道黑边。菲利克斯将军立刻看出了这不是那两万个等待接收的“个体”，而是一支准备发起攻击的陆军部队。他们队形整齐地推进着，菲利克斯放下望远镜，用肉眼也能看到桑比亚军队像黑色的地毯一样渐渐覆盖了平原。</p>
<p>　　他再次举起望远镜，看到阵线在加快速度，很快整个方阵都飞奔起来，黑人士兵们高举着冲锋枪怒吼着，像潮水一样扑向大海。</p>
<p>　　“桑比亚人要投海自杀？”舰队中所有目睹这一壮观景象的人都迷惑不解。在林肯号上，菲利克斯将军首先发现了什么，脸一下变得煞白，他扔下望远镜，声嘶力竭地大叫起来。</p>
<p>　　“战斗警报！舰炮射击！所有攻击机起飞！快！”</p>
<p>　　战斗警报尖厉地响起。已冲到海边的桑比亚步兵阵线中突然出现了一大片白色的东西，那一片白色急剧抖动着，激起了高高的尘埃，舰队的人们一时无法相信自己的眼睛。</p>
<p>　　所有的桑比亚士兵都长着一对白色的翅膀，这是两万多名会飞的人！</p>
<p>　　在一片尘埃之上，飞人升到空中，飞行的阵线黑压压一片，遮住了初升的太阳，这空中军队越海向舰队扑来。</p>
<p>　　这时，舰队的宙斯盾系统已对来袭的飞人做出了反应，首批舰对空导弹从林肯号周围的巡洋舰射向飞人，约五十条白色的烟迹扎入了飞人群中。这首批导弹都击中了目标，清脆的爆炸声从空中传来，在一阵闪光后飞人群中出现了一团团黑烟，被击中的飞人血肉横飞，翅膀的白色羽毛如一片片细微的雪花在天空飘散。航母上观战的人们发出一阵欢呼声，但凭理智仔细观察攻击效果的菲利克斯将军和布莱尔舰长心凉了半截，一道简单但严酷算术题摆在他们面前。</p>
<p>　　从现在的情况看，每枚航空导弹在击中目标时，弹头爆炸的杀伤力可击落周围2到3个人飞人。舰队的舰空导弹的弹头是为击毁空中战机这样的点状目标而设计的，爆炸时只产生很少的高速弹片，因而面积杀伤力不大，而飞人受到导弹攻击后正以很快的速度散开，所以，一枚舰空导弹很快只能击落一个飞人了。具有较强面积杀伤力的舰对舰导弹和巡航导弹对这样方向和距离的目标毫无用处。</p>
<p>　　这里还有一个致命的弱点：舰队的舰空导弹中只有不到一半采用传统的红外、雷达和激光制导方式，这大多是上世纪就已准备的“海标枪”、“海麻雀”和“标枪”型舰空导弹。</p>
<p>　　近年来，被这只强大舰队真正引以为骄傲的是采用像素制导的舰空导弹，像素制导是上世纪的导弹设计师们追求已久的梦想，在这种制导方式下，导弹感受到的目标不再是传统制导方式下的点状，而是一个三维图像，通过高超的模式匹配技术对目标进行识别，正如给导弹装上了一双智慧的眼睛，这就使得导弹可以打击目标最致命的部位，因而像素制导导弹的战斗部较传统导弹大为减小。但现在在这双智慧之眼中，那些飞人怎么看也不像是需要打击的空中目标，更像是大些的飞鸟，所以这些聪明的导弹都做出了理智的选择：绕开他们。人工智能再一次变成了人工愚蠢，更换每个导弹的模式数据库是无论如何也来不及了。</p>
<p>　　整个舰队携带的舰对空导弹约为3000枚，这比正常情况已超载一倍了。这样数量的导弹在“宙斯盾”系统的引导下，足以对付一个大国的全部空军力量对舰队发动的攻击，进行这种攻击的敌机可能有两千架左右。而现在，舰队面对着十倍数量的飞人，每个飞人对舰只的攻击能力当然无法同战机相比，但要击落它，也要耗费一枚导弹。用航母上的战斗机对付飞人，道理也一样，况且战斗机可能来不及起飞。于是，两位将军，他们统率着这个星球上最强大的舰队，现在不得不承认这样的现实：对于飞人，航母战斗群的主要武器不再具有优势，质量代替不了数量。</p>
<p>　　林肯号的周围，舰空导弹一批接着一批地发射，导弹的尾迹在空中组成一团巨大的乱麻。</p>
<p>　　舰队没有人欢呼了，现在即使普通水兵也解开了那道算术题，以往他们最引以为自豪的东西现在也靠不上了。</p>
<p>　　当所有的舰空导弹全部用光后，只击中了不到两千个飞人，而现在，从海岸方向向舰队冲来的飞人阵线前锋，已掠过了战斗群外围的巡洋舰和驱逐舰，直向林肯号航母扑来。</p>
<p>　　现在，舰队只能依靠舰炮和机枪火力了，几乎所有的舰炮都全力射击。打击飞人最为有效的武器是密集阵火炮系统，它原是用于击落1500米范围内突破舰队防御系统的漏网反舰导弹的，它由6管20毫米火炮组成，具有每分钟3000发的高射速。密集阵火炮的每一次扫射，都在空中划出一条死亡的曲线，都有一排飞人被它那密集的弹流击落。但密集阵火炮无法长时间连续射击，它的高射速和快初速使炮管很快发热老化，必须频繁地更换，加上数量有限，它们最终也无法对来袭的大批飞人形成有力的阻击。其它的大口径舰炮射速太慢，同时，飞人的飞行轨迹是一条不断波动的正弦线，用普通舰炮对它们射击就像用步枪打蝴蝶一样，命中率很低。所以现在惟一能依靠的武器就是机枪了。</p>
<p>　　这时，菲利克斯的脑海中浮现出古代中国关于冷兵器战争的一句话“临敌不过三发”，意思是说在敌人的骑兵冲到阵地前这段时间里，弓箭手只能射出三支箭，这绝妙地反映了目前林肯号的处境。</p>
<p>　　现在，飞人开始对林肯号冲击了，飞人从各个高度接近航母，最高的飞人飞到上千米，最低的紧贴海面掠过。近两万名飞人使林肯号笼罩在一团死亡的阴云中，航母上的人听到从各个方向传来的飞人的呼喊声，这些声音使他们他们头皮发炸，抬头看着那密密麻麻的遮住阳光的飞人群在头顶盘旋，他们仿佛身处噩梦之中，同时也意识到一个严酷的现实：在高技术的温床中沉浸了几十年后，他们终于获得了一个成为真正战士的机会——要同敌人面对面肉搏了。</p>
<p>　　意识到这点，菲利克斯反而冷静了许多，他拿起扩音器，沉着地发出命令：“立刻向舰上人员分发所有轻武器，重点防守塔岛、升降机口、弹药库、航空油库和核反应堆。这是最高指挥官在说话，全舰人员，准备接敌近战！”</p>
<p>　　布莱尔舰长茫然地看着菲利克斯将军，好半天才理解了他的话的含义。他默默地走到海图桌面前，从一个抽屉里拿出自己的手枪，他看着枪，无言地沉思着。突然，他听到了一声悠扬的嘶鸣，是那匹小飞马发出的。舰长抬枪对着小马射出三发子弹，那个美丽的小精灵倒在血泊中。</p>
<p>　　又一个措手不及的尴尬场面出现了：在早期航母中，轻武器是由各战位分散保管的，但由于自二战以来舰上人员从未有使用轻武器的机会，所以不知从什么时候起，现代航母上的轻武器都在一个专用仓库中集中保管。林肯号上有近六千人，除了岗位不能离开的人外，有近四千人拥向位于航母中层的军火库中去领枪，一时把狭窄的通道堵塞了。军火库门口更是乱做一团，负责发放武器的军官只能把枪向人群中扔，领到枪的人也挤不出去，只能把枪向后传，看上去很像近代某个城市暴动的场面。这时林肯号广阔的飞行甲板只能由舰上数量不多的海军陆战队守卫了。</p>
<p>　　第一个飞人在林肯号的飞行甲板上着陆了，他那雪白的双翅轻盈地抖动，双脚接触到甲板时没发出一点声音。这时谁也不会认为他是魔鬼，这是希腊神话中才有的人物，是神灵的化身，它来自远古的梦幻，如同一个美丽的幻影降落到人类这粗陋的钢铁世界中。甲板上的陆战队员被他那惊人的美震撼了，很多人呆呆地站着，忘了开枪。但这个飞人战士还是很快被来自各个方向的弹雨击倒了，飞人倒在甲板上，双翅上雪白的羽毛被他自己的鲜血染红了。紧接着又有三个飞人着舰，其中一名幸存下来，躲到飞行甲板左舷的一个光学引导装置后面同陆战队员们对射起来。</p>
<p>　　又有几个飞人降落被击毙后，飞人战士们意识到这时着舰代价太大，就开始从空中向航母投掷手榴弹。航母上的人们也尝到了被轰炸的滋味，当一大群飞人呼啸着从飞行甲板上空掠过后，手榴弹如冰雹般劈哩啪啦地落下，然后在一片爆炸声中，那些仍停在甲板上的昂贵的“雄猫”和“大黄蜂”一架架被炸成碎片。</p>
<p>　　来自空中的手榴弹成功地遏制了航母上的轻武器火力，飞人的第二次强行降落取得了成功，很快就有上百名飞人战士登上了林肯号，他们依托着左右舷的下陷结构和甲板上飞机的残骸同舰上的陆战队和水兵枪战，掩护更多的飞人着舰。</p>
<p>　　现在，令林肯号的守卫者们最尴尬的局面出现了：首先，他们在人员素质上处于劣势。经过基因优化，又在非洲丛林中成长的飞人是天生的战士，在这传统的近战中，他们骁勇敏捷，所向无敌。而林肯号上的人，除了为数不多的海军陆战队员外，其他人与其说是军人还不如说是工程师和技师，受过的陆战训练不多，在这残酷的近战中根本不是飞人战士的对手。最可怜的要数那些飞行员了，这些曾令多少敌人闻风丧胆的空中杀手，航母战斗群的刀锋，现在什么都不是了。布莱尔悲哀地从舰长室的窗中看到一名中校飞行员，缩在F14的座舱中，伸出手枪乱打一气，弹夹打光了还在不停扣扳机，直到一名脸上涂着红黑相间条纹的飞人爬上飞机，用一把猎刀砍下他的脑袋为止……</p>
<p>　　更令“第一伦理”行动的执行者们无法忍受的是，他们现在在武器上也处于劣势！在这样的近战中，他们的M16步枪并不比桑比亚飞人手中古老的AK47好多少。而且，林肯号上轻武器库中的步枪只有不到两千支，这样，舰上大部分人只能用手枪作战了。林肯号上的6000官兵不过是被堵在钢铁中的一堆肉而已。</p>
<p>　　在三个足球场大小的飞行甲板上，飞人仍在以很快的速度降落，现在，他们在舰上的人数已过千人。林肯号虽然在人数上仍占优势，但大部分人都被刚才飞人从空中的手榴弹轰炸堵在舱内，飞行甲板渐渐被飞人战士控制。现在，他们重点攻击的目标有两个：一个是飞机升降机口，这是进入舰体内最宽敞的通道；另一个是塔岛，这是航母的神经中枢。</p>
<p>　　一群飞人从舰长室外掠过，可以听到手榴弹乒乒乓乓地砸在舱壁上，有一枚破窗而入，落到海图桌上。看着那个冒着青烟旋转的东西，菲利克斯将军仿佛走进了时间隧道，又闪回到他的青年时代。那是在热带暴雨中的越南丛林中，18岁的他也看到一枚手榴弹在眼前冒着青烟旋转，甚至外形也同眼前这颗一样，是前华约国制式武器，弹体和弹柄都是绿色的……对历史和现实的感触都凝缩在这生死一瞬，将军出神地盯着那个东西，多亏一名参谋把他扑倒在地。</p>
<p>　　又过了十几分钟，着舰的飞人已超过两千，他们完全控制了飞行甲板，也成功地阻击了周围的巡洋舰和驱逐舰上的增援。现在从外面看，林肯号上已全是飞人的身影，AK冲锋枪嘶哑粗放的射击声盖住了一切，M16步枪纤细的啪啪声只能零星听到。</p>
<p>　　突然，布莱尔舰长听到了一声爆炸，从升降机方向传来。同到处响起的手榴弹爆炸声相比，它很沉闷，只是隐隐约约能听到。他的心顿时沉到了底，作为一名经验丰富的军人他不会听错的，这是飞人战士在用塑性炸药炸开舰体内部的水密门，他们已进入了林肯号。菲利克斯也意识到了这点，他知道，现代巨型航空母舰的内部结构是极其复杂的，即使舰上人员，在没有地图的情况下也会迷路。但对于飞人战士，这可能不是个太大的障碍，因为他们要找的地方都是体积庞大的方位明确的。林肯号有三个致命处：弹药库、航空油库（存放着供舰上作战飞机使用的8000吨航空燃油）和为全舰提供动力的两座压水核反应堆，飞人战士找到这三样东西中的任何一样，林肯号就死定了。同时，核动力航母是一个极其复杂的系统，在内部随意的破坏也可能带来致命的后果。</p>
<p>　　那不详的爆炸声又响了起来，一声比一声更沉闷，如同一只巨兽的脚步，一步步走向林肯号的深处走去……</p>
<p>　　现在，结局只是时间问题。</p>
<p>　　着舰的飞人已过五千，甲板上的战斗基本停止了，而指挥塔岛同全舰和外界的联系几乎中断，虽然塔岛还未完全失守，林肯号已失去了大脑。</p>
<p>　　在以后的一个多小时内，林肯号几乎沉静下来，只有舰体内的爆炸声能隐约听到，而且向不同的方向扩散。飞人战士像进入林肯号这只巨兽体内的无数只蚂蚁，正在吞食着它的内脏。同时，飞人加强了对塔岛的攻击，在从下面攻打的同时，他们从空中直接跳到塔岛的上层建筑上。</p>
<p>　　突然，林肯号微微振动了一下，布莱尔冲到窗边，看到大团的白色蒸气从舰体两侧升起，并听到一阵隆隆声，那是舰体下面的海水沸腾的声音。舰长知道，飞人战士找到了林肯号三个致命处的一个：核反应堆。虽然反应堆在舰体的最下部，但它们的方位是最明确的。</p>
<p>　　飞人战士显然已炸毁了反应堆的冷却系统，布莱尔可以想像，堆中的反应物质如火山岩浆般流了出来，但它比岩浆灼热许多倍，它流到航母的舰底，就如同把烧红的火炭放到硬纸板上一样，很快就把舰底烧穿了。</p>
<p>　　又一阵冰雹般的手榴弹扔到舰长室周围，震耳欲聋的爆炸后，AK冲锋枪密集地在外面响了起来，好像是一阵突然爆发的狂笑。保卫舰长室的陆战队员们在舱门和窗口相继倒毙，一群飞人战士撞开门冲了进来，他们的翅膀合在身后，像是披着白色的斗篷。布莱尔舰长伸手去拿放在海图上的手枪，立刻同几名年轻参谋一起被眼疾手快的飞人战士乱枪打死。菲利克斯将军手里握着枪，但没举起来，飞人战士盯着他肩上的四颗星，没有再开枪，他们就这样对峙着。</p>
<p>　　飞人们突然向两边分开，伊塔博士走了进来。他们仍披着那块披布，同周围戎装的飞人战士形成鲜明的对比，一个飞人用生疏的英语让菲利克斯放下武器。</p>
<p>　　菲利克斯仍紧握着手枪，用另一只手整理了一下军服：“开枪吧，黑鬼。”</p>
<p>　　伊塔博士抬起头来，菲利克斯又一次看到了他那深邃的双眼。</p>
<p>　　“将军，我们的血也是红的。”</p>
<p>　　“你们可以击沉林肯号，但最后一个也跑不掉的！”</p>
<p>　　伊塔笑了一下，这是菲利克斯第一次看到他笑。“他们当然能跑掉，他们可以任意飞越国境，雷达系统不能把他们同飞鸟区别开来，他们到处都能得到食物，即使是现代社会，要消灭这样一批人也是不容易的。更重要的是，他们很快就会成为合法的人，将享有作为一个人的一切权利。”</p>
<p>　　“这我不明白。”</p>
<p>　　“您是个聪明人，正如您所说，即使在所谓的文明世界，只要有需要，伦理是第二位的。</p>
<p>　　那里的人们当然不需要吃野草和树叶，但他们肯定需要飞翔，这是人类最古老的梦幻，没人能抵挡它的诱惑。您将会看到，想像中的魔鬼并不存在，天使时代即将到来，在那个美好的时代里，人类在城市和原野上空飞翔，蓝天和白云是他们散步的花园，人类还将像鱼一样潜游在海底，并且以上千岁的寿命来享受这一切。将军，您已经看到了这个时代的曙光。“</p>
<p>　　伊塔博士说完，转身走了出去，同时用桑比亚语说了句什么，接着所有的飞人战士都转身走了，没有一个人再看菲利克斯一眼。</p>
<p>　　林肯号航空母舰直到黄昏时才完全沉没，当舰上的塔岛最后沉入水中时，被压出的空气发出巨大的嘶鸣，像非洲海岸凄厉的号角，菲利克斯将军站在一艘巡洋舰的舰桥上，用困惑的目光望着远方古老的土地。</p>
<p>　　在那块百万年前诞生人类的土地上，飞人群正在夕阳中盘旋。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/17/es6 扩展运算符 三个点（...）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/17/es6 扩展运算符 三个点（...）/" itemprop="url">es6 扩展运算符 三个点（...）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-17T14:46:18+08:00">
                2017-02-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="它是什么"><a href="#它是什么" class="headerlink" title="它是什么"></a>它是什么</h1><p>es6中引入扩展运算符（…），它用于把一个数组转化为用逗号分隔的参数序列，它常用在不定参数个数时的函数调用，数组合并等情形。因为typeScript是es6的超集，所以<strong>typeScript也支持扩展运算符</strong>。</p>
<h1 id="用在哪儿"><a href="#用在哪儿" class="headerlink" title="用在哪儿"></a>用在哪儿</h1><h3 id="可变参数个数的函数调用"><a href="#可变参数个数的函数调用" class="headerlink" title="可变参数个数的函数调用"></a>可变参数个数的函数调用</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">push</span>(<span class="params">array, ...items</span>) </span>&#123;  </span><br><span class="line">  array.push(...items);  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">...vals</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> sum=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;vals.length;i++)&#123;</span><br><span class="line">    sum+=vals[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line"><span class="keyword">let</span> sum = add(...arr);</span><br><span class="line"><span class="built_in">console</span>.log(sum);  <span class="comment">//21</span></span><br></pre></td></tr></table></figure>
<h3 id="更便捷的数组合并"><a href="#更便捷的数组合并" class="headerlink" title="更便捷的数组合并"></a>更便捷的数组合并</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr1 = [<span class="number">1</span>,<span class="number">2</span>];</span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line"><span class="keyword">let</span> newArr = [<span class="number">20</span>];</span><br><span class="line"><span class="comment">//es5 旧写法</span></span><br><span class="line">newArr = newArr.concat(arr1).concat(arr2); <span class="comment">//[20,1,2,5,6]</span></span><br><span class="line"><span class="built_in">console</span>.log(newArr);</span><br><span class="line"><span class="comment">//es6 使用扩展运算符</span></span><br><span class="line">newArr = [<span class="number">20</span>,...arr1,...arr2];  <span class="comment">//[20,1,2,5,6]</span></span><br><span class="line"><span class="built_in">console</span>.log(newArr);</span><br></pre></td></tr></table></figure>
<h3 id="替代es5的apply方法"><a href="#替代es5的apply方法" class="headerlink" title="替代es5的apply方法"></a>替代es5的apply方法</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5 的写法  </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x, y, z</span>) </span>&#123;  </span><br><span class="line"><span class="comment">// ...  </span></span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">var</span> args = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];  </span><br><span class="line">f.apply(<span class="literal">null</span>, args);  </span><br><span class="line"><span class="comment">// ES6 的写法  </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x, y, z</span>) </span>&#123;  </span><br><span class="line"><span class="comment">// ...  </span></span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">var</span> args = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];  </span><br><span class="line">f(...args);</span><br></pre></td></tr></table></figure>
<p>求最大值Math.max()</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5 的写法  </span></span><br><span class="line"><span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, [<span class="number">14</span>, <span class="number">3</span>, <span class="number">77</span>])  </span><br><span class="line"><span class="comment">// ES6 的写法  </span></span><br><span class="line"><span class="built_in">Math</span>.max(...[<span class="number">14</span>, <span class="number">3</span>, <span class="number">77</span>])  </span><br><span class="line"><span class="comment">//  等同于  </span></span><br><span class="line"><span class="built_in">Math</span>.max(<span class="number">14</span>, <span class="number">3</span>, <span class="number">77</span>);</span><br></pre></td></tr></table></figure>
<p>通过push函数，将一个数组添加到另一个数组的尾部</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5 的写法  </span></span><br><span class="line"><span class="keyword">var</span> arr1 = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];  </span><br><span class="line"><span class="keyword">var</span> arr2 = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];  </span><br><span class="line"><span class="built_in">Array</span>.prototype.push.apply(arr1, arr2);  </span><br><span class="line"><span class="comment">// ES6 的写法  </span></span><br><span class="line"><span class="keyword">var</span> arr1 = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];  </span><br><span class="line"><span class="keyword">var</span> arr2 = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];  </span><br><span class="line">arr1.push(...arr2);</span><br></pre></td></tr></table></figure>
<p>新建Date类型</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5  </span></span><br><span class="line"><span class="keyword">new</span> (<span class="built_in">Date</span>.bind.apply(<span class="built_in">Date</span>, [<span class="literal">null</span>, <span class="number">2015</span>, <span class="number">1</span>, <span class="number">1</span>]))  </span><br><span class="line"><span class="comment">// ES6  </span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(...[<span class="number">2015</span>, <span class="number">1</span>, <span class="number">1</span>]);</span><br></pre></td></tr></table></figure>
<h3 id="与解构赋值结合，生成新数组"><a href="#与解构赋值结合，生成新数组" class="headerlink" title="与解构赋值结合，生成新数组"></a>与解构赋值结合，生成新数组</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5  </span></span><br><span class="line">a = list[<span class="number">0</span>], rest = list.slice(<span class="number">1</span>)  </span><br><span class="line"><span class="comment">// ES6  </span></span><br><span class="line">[a, ...rest] = list </span><br><span class="line">下面是另外一些例子。  </span><br><span class="line"><span class="keyword">const</span> [first, ...rest] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];  </span><br><span class="line">first <span class="comment">// 1  </span></span><br><span class="line">rest <span class="comment">// [2, 3, 4, 5]  </span></span><br><span class="line"><span class="keyword">const</span> [first, ...rest] = [];  </span><br><span class="line">first <span class="comment">// undefined  </span></span><br><span class="line">rest <span class="comment">// []:  </span></span><br><span class="line"><span class="keyword">const</span> [first, ...rest] = [<span class="string">"foo"</span>];  </span><br><span class="line">first <span class="comment">// "foo"  </span></span><br><span class="line">rest <span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<h3 id="将字符串转为真正的数组"><a href="#将字符串转为真正的数组" class="headerlink" title="将字符串转为真正的数组"></a>将字符串转为真正的数组</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[...<span class="string">'hello'</span>]  </span><br><span class="line"><span class="comment">// [ "h", "e", "l", "l", "o" ]</span></span><br></pre></td></tr></table></figure>
<h3 id="将实现了-Iterator-接口的对象转为数组"><a href="#将实现了-Iterator-接口的对象转为数组" class="headerlink" title="将实现了 Iterator 接口的对象转为数组"></a>将实现了 Iterator 接口的对象转为数组</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> nodeList = <span class="built_in">document</span>.querySelectorAll(<span class="string">'div'</span>);  </span><br><span class="line"><span class="keyword">var</span> array = [...nodeList];</span><br></pre></td></tr></table></figure>
<hr>
<p>end 2017-02-17 14:46:14</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/08/ionic2页面page的生命周期钩子函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/08/ionic2页面page的生命周期钩子函数/" itemprop="url">ionic2页面page的生命周期钩子函数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-08T11:45:54+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ionic2页面page的生命周期钩子函数"><a href="#ionic2页面page的生命周期钩子函数" class="headerlink" title="ionic2页面page的生命周期钩子函数"></a>ionic2页面page的生命周期钩子函数</h1><ul>
<li><p>Page Event    Returns    Description</p>
</li>
<li><p><code>ionViewDidLoad</code>    void    Runs when the page has loaded. This event only happens once per page being created. If a page leaves but is cached, then this event will not fire again on a subsequent viewing. The ionViewDidLoad event is good place to put your setup code for the page.</p>
</li>
<li><code>ionViewWillEnter</code>    void    Runs when the page is about to enter and become the active      page.</li>
<li><code>ionViewDidEnter</code>    void    Runs when the page has fully entered and is now the active page. This event will fire, whether it was the first load or a cached page.</li>
<li><code>ionViewWillLeave</code>    void    Runs when the page is about to leave and no longer be the active page.</li>
<li><code>ionViewDidLeave</code>    void    Runs when the page has finished leaving and is no longer the active page.</li>
<li><code>ionViewWillUnload</code>    void    Runs when the page is about to be destroyed and have its elements removed.</li>
<li><code>ionViewCanEnter</code>    boolean/Promise<void>    Runs before the view can enter. This can be used as a sort of “guard” in authenticated views where you need to check permissions before the view can enter</void></li>
<li><code>ionViewCanLeave</code>    boolean/Promise<void>    Runs before the view can leave. This can be used as a sort of “guard” in authenticated views where you need to check permissions before the view can leave</void></li>
</ul>
<hr>
<p>end 2017-02-08 11:44:47</p>
<p>参考文档：<a href="http://ionicframework.com/docs/v2/api/navigation/NavController/" target="_blank" rel="noopener">http://ionicframework.com/docs/v2/api/navigation/NavController/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/08/2017-02-08-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/08/2017-02-08-1/" itemprop="url">ionic2使用根导航（rootNav）跳转</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-08T11:32:13+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ionic2使用根导航（rootNav）跳转"><a href="#ionic2使用根导航（rootNav）跳转" class="headerlink" title="ionic2使用根导航（rootNav）跳转"></a>ionic2使用根导航（rootNav）跳转</h1><p>在一个使用tab构建的ionic2应用程序中，如果我们直接使用<code>NavController</code>进行导航跳转，会将新的page压入当前tab的导航栈中。但login、signin、setting等page在业务上不应该属于当前tab，而应该从根组件进行导航，那么此时该如何做呢？<br>看下面的例子即可：</p>
<h2 id="在一个组件中跳转到根导航中"><a href="#在一个组件中跳转到根导航中" class="headerlink" title="在一个组件中跳转到根导航中"></a>在一个组件中跳转到根导航中</h2><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; App, ViewController &#125; <span class="keyword">from</span> <span class="string">'ionic-angular'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;ion-content&gt;</span></span><br><span class="line"><span class="string">      &lt;h1&gt;My PopoverPage&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      &lt;button ion-button (click)="pushPage()"&gt;Call pushPage&lt;/button&gt;</span></span><br><span class="line"><span class="string">     &lt;/ion-content&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">class</span> PopoverPage &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">      <span class="keyword">public</span> viewCtrl: ViewController</span></span><br><span class="line"><span class="params">      <span class="keyword">public</span> appCtrl: App</span></span><br><span class="line"><span class="params">    </span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    pushPage() &#123;</span><br><span class="line">      <span class="keyword">this</span>.viewCtrl.dismiss();</span><br><span class="line">      <span class="keyword">this</span>.appCtrl.getRootNav().push(SecondPage);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="在主组件中跳转到一个根导航"><a href="#在主组件中跳转到一个根导航" class="headerlink" title="在主组件中跳转到一个根导航"></a>在主组件中跳转到一个根导航</h2><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, ViewChild &#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; NavController &#125; <span class="keyword">from</span> <span class="string">'ionic-angular'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">   template: <span class="string">'&lt;ion-nav #myNav [root]="rootPage"&gt;&lt;/ion-nav&gt;'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> MyApp &#123;</span><br><span class="line">   <span class="meta">@ViewChild</span>(<span class="string">'myNav'</span>) nav: NavController</span><br><span class="line">   <span class="keyword">public</span> rootPage = TabsPage;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Wait for the components in MyApp's template to be initialized</span></span><br><span class="line">   <span class="comment">// In this case, we are waiting for the Nav with reference variable of "#myNav"</span></span><br><span class="line">   ngOnInit() &#123;</span><br><span class="line">      <span class="comment">// Let's navigate from TabsPage to Page1</span></span><br><span class="line">      <span class="keyword">this</span>.nav.push(Page1);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>end 2017-02-08 11:32:08<br>参考文档： <a href="http://ionicframework.com/docs/v2/api/navigation/NavController/" target="_blank" rel="noopener">http://ionicframework.com/docs/v2/api/navigation/NavController/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/08/2017-02-08/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/08/2017-02-08/" itemprop="url">Angular组件生命周期和钩子函数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-08T10:28:36+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Angular组件生命周期和钩子函数"><a href="#Angular组件生命周期和钩子函数" class="headerlink" title="Angular组件生命周期和钩子函数"></a>Angular组件生命周期和钩子函数</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>angular2中每个组件都有其生命周期，包括创建组件、渲染组件、创建渲染子组件、绑定的属性发生变化时检查它、从dom中移除。<br>angular2提供了<strong>声明周期钩子函数</strong>，把这些关键的周期暴露给我们，以便我们做一些自定义的操作。</p>
<p><img src="http://ol1ftyec4.bkt.clouddn.com/2017-02-08-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-02-08%2010.49.03-1.png" alt="屏幕快照 2017-02-08 10.49.03"></p>
<h2 id="声明周期顺序解释"><a href="#声明周期顺序解释" class="headerlink" title="声明周期顺序解释"></a>声明周期顺序解释</h2><ul>
<li><code>ngOnChanges</code> 当angular绑定的输入属性发生变化时响应，首次调用一定会发生在ngOnInit之前</li>
<li><code>ngOnInit</code> 初始化指令/组件，在第一轮ngOnChanges完成之后调用，<strong>只调用一次</strong></li>
<li><code>ngDoCheck</code>在每个angular变更检测周期中调用，在ngOnChanges和ngOnInit之后调用</li>
<li><code>ngAfterContentInit</code> 把内容渲染到组件之后调用，第一次ngDoCheck之后调用，只适用于组件，<strong>只调用一次</strong></li>
<li><code>ngAfterContentChecked</code> 每次完成内容到组件的渲染的变更检测后调用，ngAfterContentInit和每次NgDoCheck之后调用，只适用于组件</li>
<li><code>ngAfterViewInit</code> 组件视图及其子视图初始化完成之后调用，第一次ngAfterContentChecked之后调用，<strong>只调用一次</strong>，只适合组件</li>
<li><code>ngAfterViewChecked</code> 每次做完组件视图和子视图的变更检测之后调用，ngAfterViewInit和每次ngAfterContentChecked之后调用，<br>只适合组件</li>
<li><code>ngOnDestroy</code> 在Angular销毁指令/组件之前调用。</li>
</ul>
<h2 id="钩子函数执行顺序的例子"><a href="#钩子函数执行顺序的例子" class="headerlink" title="钩子函数执行顺序的例子"></a>钩子函数执行顺序的例子</h2><p><img src="http://ol1ftyec4.bkt.clouddn.com/2017-02-08-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-02-08%2011.17.24.png" alt="屏幕快照 2017-02-08 11.17.24"></p>
<blockquote>
<p>当输入属性发生变化时，就会看到<code>OnChanges</code>和至少两组<code>DoCheck</code>、<code>AfterContentChecked</code>和<code>AfterViewChecked</code>钩子执行。这四个钩子会执行很多次，应该让它们的逻辑尽可能精简，否则可能会影响用户体验。</p>
</blockquote>
<h2 id="再详细解释几个钩子函数"><a href="#再详细解释几个钩子函数" class="headerlink" title="再详细解释几个钩子函数"></a>再详细解释几个钩子函数</h2><h3 id="ngOnInit"><a href="#ngOnInit" class="headerlink" title="ngOnInit"></a>ngOnInit</h3><ul>
<li>ngOnInit是组件获取初始数据的好地方</li>
<li>在构造函数中只执行简单的局部变量初始化工作，其他什么都不要做</li>
<li>在component中，构造函数完成之前，那些绑定的输入属性还都没有值；在<code>ngOnInit</code>执行的时候，这些属性都已经被正确赋值过了</li>
</ul>
<blockquote>
<p>我们访问这些属性的第一次机会，实际上是ngOnChanges方法，Angular会在ngOnInit之前调用它。 但是在那之后，Angular还会调用ngOnChanges很多次。而ngOnInit只会被调用一次</p>
</blockquote>
<h3 id="ngDoCheck"><a href="#ngDoCheck" class="headerlink" title="ngDoCheck"></a>ngDoCheck</h3><ul>
<li>使用DoCheck钩子来检测那些Angular自身无法捕获的变更并采取行动</li>
<li>这个钩子被调用的十分频繁，应该使其实现尽可能的精简</li>
</ul>
<h3 id="AfterView"><a href="#AfterView" class="headerlink" title="AfterView"></a>AfterView</h3><p><code>AfterViewInit</code>和<code>AfterViewChecked</code>钩子，Angular会在每次创建了组件的子视图后调用它们。</p>
<h2 id="最后说明"><a href="#最后说明" class="headerlink" title="最后说明"></a>最后说明</h2><p>这是angular2组件自带的生命周期钩子函数，每个基于angular2的框架还可能会有自己的钩子函数，用以方便程序的编程。比如ionic2框架的view就有自己的生命周期钩子函数。</p>
<hr>
<p>end 2017-02-08 11:32:00</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/22/2017-01-22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/22/2017-01-22/" itemprop="url">git tag 标签使用说明</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-22T15:37:22+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="git-tag-标签使用说明"><a href="#git-tag-标签使用说明" class="headerlink" title="git tag 标签使用说明"></a>git tag 标签使用说明</h1><p><code>git tag</code>命令可以对某一时间点做标记，常用于版本发布。</p>
<h2 id="查看标签"><a href="#查看标签" class="headerlink" title="查看标签"></a>查看标签</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git tag           <span class="comment"># 查看所有标签</span></span><br><span class="line">$ git tag -l <span class="string">'v1.'</span>  <span class="comment"># 搜索符合模式的标签</span></span><br><span class="line">$ git show v1.0     <span class="comment"># 查看某个标签详情</span></span><br></pre></td></tr></table></figure>
<h2 id="添加标签"><a href="#添加标签" class="headerlink" title="添加标签"></a>添加标签</h2><h3 id="附注标签（推荐）"><a href="#附注标签（推荐）" class="headerlink" title="附注标签（推荐）"></a>附注标签（推荐）</h3><p>附注标签则是仓库中的一个独立对象,建议使用附注标签:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git tag -a v1.1 -m <span class="string">"1.1版本"</span></span><br></pre></td></tr></table></figure>
<p>参数a即annotated的缩写，指定标签类型，后面是标签名，参数m指定标签说明，说明信息会保存在标签对象中</p>
<h3 id="轻量级标签"><a href="#轻量级标签" class="headerlink" title="轻量级标签"></a>轻量级标签</h3><p>轻量标签是指向提交对象的引用:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git tag v0.1 -light</span><br></pre></td></tr></table></figure>
<h3 id="为某次commit打标签"><a href="#为某次commit打标签" class="headerlink" title="为某次commit打标签"></a>为某次commit打标签</h3><p>上面的命令默认将标签打在head上，如果需要我们也可以为之前的提交版本打标签：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline        <span class="comment"># 显示版本提交历史</span></span><br><span class="line">$ git tag -a v0.1 c8cbe39  <span class="comment"># 为c8cbe39添加标签</span></span><br></pre></td></tr></table></figure>
<h2 id="切换标签"><a href="#切换标签" class="headerlink" title="切换标签"></a>切换标签</h2><p>与切换分支命令相同：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git tag                 <span class="comment"># 显示当前分支下的标签</span></span><br><span class="line">$ git checkout [tagname]  <span class="comment"># 此时指向标签指向的代码状态（此时处于空分支）</span></span><br><span class="line">$ cat a.txt               <span class="comment"># 查看某个文件</span></span><br><span class="line">$ git checkout master     <span class="comment"># 切换回master</span></span><br></pre></td></tr></table></figure>
<h2 id="删除标签"><a href="#删除标签" class="headerlink" title="删除标签"></a>删除标签</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git tag -d v0.1 <span class="comment"># 删除标签v0.1</span></span><br></pre></td></tr></table></figure>
<p>注意：误打或需要修改标签时，需要先将标签删除，再打新标签。</p>
<h2 id="标签发布"><a href="#标签发布" class="headerlink" title="标签发布"></a>标签发布</h2><p><code>git push</code>不会将标签信息提交到远程服务器，需要显示更新标签：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git push origin v0.1   <span class="comment">#将v0.1标签提交到git服务器</span></span><br><span class="line">$ git push origin –tags  <span class="comment">#将本地所有标签一次性提交到git服务器</span></span><br></pre></td></tr></table></figure>
<hr>
<p>end 2017-01-22 15:38:33</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/19/2017-01-19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/19/2017-01-19/" itemprop="url">为本地git仓库新增github远程仓库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-19T17:54:05+08:00">
                2017-01-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="为本地git仓库新增github远程仓库"><a href="#为本地git仓库新增github远程仓库" class="headerlink" title="为本地git仓库新增github远程仓库"></a>为本地git仓库新增github远程仓库</h1><p>人已新建过几个github仓库，但每次用的方法不一样，这里整理一个简单的方法流程，供以后参考。</p>
<ol>
<li>登录github，新建一个空repository</li>
<li><p>为本地项目添加远程地址</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git remote add origin git@github.com:hao5743/gittest.git</span><br></pre></td></tr></table></figure>
</li>
<li><p>推送到远程</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git push -u origin master</span><br></pre></td></tr></table></figure>
<p> 第一次推送的时候，需要加上<code>-u</code>参数，Git不但会把本地的<code>master</code>分支内容推送的远程新的<code>master</code>分支，还会把本地的<code>master</code>分支和远程的<code>master</code>分支关联起来，以后就可以简化命令</p>
<p> 之后使用<code>git push</code>,<code>git pull</code>命令就行了</p>
</li>
</ol>
<hr>
<p>end. 2017-01-19 17:55:57</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/30/关于gitosis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/30/关于gitosis/" itemprop="url">关于gitosis</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-30T10:29:00+08:00">
                2016-12-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="关于gitosis"><a href="#关于gitosis" class="headerlink" title="关于gitosis"></a>关于gitosis</h1><p>在工作中，我们有自己的git服务器，但是随着git项目的增多和项目成员的增多，我们开始使用了<code>Gitosis</code>软件。使用它可以方便的管理与git相关的如成员公钥、权限、项目成员等问题，这里我只对我项目中用到一些简单配置做了整理和记录，并非全面的介绍gitosis。这里提供一份更为详尽介绍的<a href="https://git-scm.com/book/zh/v1/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-Gitosis" target="_blank" rel="noopener">文档</a>。</p>
<p>Git是非常著名的分布式版本控制系统。</p>
<p><strong>Gitosis则是方便通过Git与ssh架设中央服务器的软件。</strong></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>已经配置安装好，故没有从头介绍，如需要看这个<a href="https://git-scm.com/book/zh/v1/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-Gitosis" target="_blank" rel="noopener">安装步骤</a></p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>gitosis安装好之后的几个目录说明：</p>
<p><code>/home/git</code>目录: gitosis默认把这里作为存储所有 Git 仓库的根目录</p>
<p><code>/home/git/repositories</code>目录: 这里是存放需要管理的git项目（无需直接操作这个目录，要用gitosis来管理） </p>
<h3 id="管理"><a href="#管理" class="headerlink" title="管理"></a>管理</h3><p>远程克隆gitosis到本地，方便管理</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在你的本地计算机上</span></span><br><span class="line">git@gitserver:gitosis-admin.git</span><br></pre></td></tr></table></figure>
<p>如果你无法克隆，说明你没有权限，也就是<code>gitosis.conf</code>中<code>[group gitosis-admin]</code>没有存储你的公钥。你需要联系管理员给你管理权限。</p>
<h3 id="创建者或管理员新增一个管理员权限"><a href="#创建者或管理员新增一个管理员权限" class="headerlink" title="创建者或管理员新增一个管理员权限"></a>创建者或管理员新增一个管理员权限</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在创建者或管理员的机器上（如有略过）</span></span><br><span class="line">$ git <span class="built_in">clone</span> git@gitserver:gitosis-admin.git</span><br><span class="line">$ <span class="built_in">cd</span> gitosis-admin.git</span><br><span class="line"><span class="comment"># 被添加者上传自己公钥（如有略过）</span></span><br><span class="line">$ scp ~/.ssh/id_rsa.pub 用户名@主机:/tmp</span><br><span class="line"><span class="comment"># 管理员拷贝公钥到keydir,并重命名（如有略过）</span></span><br><span class="line">$ cp /tmp/id_rsa.pub keydir/tom.pub</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始配置</span></span><br><span class="line"><span class="comment"># 编辑gitosis.conf,在[group gitosis-admin]下members中添加成员tom</span></span><br><span class="line">$ vim gitosis.conf</span><br><span class="line"><span class="comment"># ...编辑操作...wq...</span></span><br><span class="line"><span class="comment"># [group gitosis-admin]</span></span><br><span class="line"><span class="comment"># members = admin tom</span></span><br><span class="line"><span class="comment"># writable = gitosis-admin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交更改（有可能需要先git add）</span></span><br><span class="line">$ git commit</span><br><span class="line">$ git push</span><br><span class="line"></span><br><span class="line"><span class="comment"># OK！tom用户现在已经有gitosis的管理权限了，</span></span><br><span class="line"><span class="comment"># 它可以克隆gitosis-admin.git它的个人电脑上，并执行管理操作</span></span><br></pre></td></tr></table></figure>
<p>目录说明：</p>
<p><code>gitosis.conf</code>文件: 此处用于项目配置，包括gitosis管理员、git项目读写权限</p>
<p><code>keydir</code>目录: 此处存放着相关用户的公钥</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/29/git status可能展示的几种情况/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/29/git status可能展示的几种情况/" itemprop="url">git status可能的情况</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-29T17:29:54+08:00">
                2016-12-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="git-status可能的情况"><a href="#git-status可能的情况" class="headerlink" title="git status可能的情况"></a>git status可能的情况</h1><p>工作中我们使用git作为版本管理工具，它的确是一个强大的工具。易于学习和使用，但是要学习的面面俱到也很难，就<code>git status</code>就可能会出现n多种的情况。本文记录了<code>git status</code>可能出现的不同状态信息、状态说明、处理办法。注意，列举的情况并不全面，只是列举了工作中遇到的一些常见情况，同时遇到新状态，还会随时增加。</p>
<p><strong>git仓库中文件的状态</strong><br>git仓库中所有文件可分为两种状态<strong>已跟踪</strong>和<strong>未跟踪</strong>。已跟踪的文件被git纳入了版本控制，git会记录它的每次更新状态。<br>状态生命周期有四种：untracked, unmodified, modified, staged</p>
<p><strong>git status可能的情况：</strong></p>
<h2 id="1-Your-branch-is-ahead-of-‘origin-master’-by-1-commit"><a href="#1-Your-branch-is-ahead-of-‘origin-master’-by-1-commit" class="headerlink" title="1. Your branch is ahead of ‘origin/master’ by 1 commit."></a>1. Your branch is ahead of ‘origin/master’ by 1 commit.</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is ahead of &apos;origin/master&apos; by 1 commit.</span><br><span class="line">  (use &quot;git push&quot; to publish your local commits)</span><br><span class="line">nothing to commit, working directory clean</span><br><span class="line">cochona@cochona:~/gitosis-admin/keydir$</span><br></pre></td></tr></table></figure>
<p>此时说明当前目录中所有的已跟踪文件，都已经和远程保持同步，并且没有修改。刚从远程克隆的git仓库，都是这个状态。</p>
<h2 id="2-nothing-added-to-commit-but-untracked-files-present"><a href="#2-nothing-added-to-commit-but-untracked-files-present" class="headerlink" title="2. nothing added to commit but untracked files present"></a>2. nothing added to commit but untracked files present</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Initial commit</span><br><span class="line">Untracked files:</span><br><span class="line">	(use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">a.text</span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br></pre></td></tr></table></figure>
<p>表示此时目录下，有新添加的未被跟踪的文件，如果我们需要将此文件提交到仓库，可以执行git add</p>
<h2 id="3-Changes-to-be-committed-new-file"><a href="#3-Changes-to-be-committed-new-file" class="headerlink" title="3. Changes to be committed: new file"></a>3. Changes to be committed: new file</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">	(use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line">   new file:   README</span><br></pre></td></tr></table></figure>
<p>在“Changes to be committed”这行下面的都是已暂存的状态，此时可以执行git commit</p>
<h2 id="4-Changes-to-be-committed-modified"><a href="#4-Changes-to-be-committed-modified" class="headerlink" title="4. Changes to be committed: modified"></a>4. Changes to be committed: modified</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cochona@cochona:~/gitosis-admin$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with &apos;origin/master&apos;.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line">	</span><br><span class="line">	modified:   gitosis.conf</span><br></pre></td></tr></table></figure>
<p>有修改的文件，此时可以选择直接<code>git commit -m &quot;info&quot;</code>    </p>
<h2 id="5-Changes-not-staged-for-commit-modified"><a href="#5-Changes-not-staged-for-commit-modified" class="headerlink" title="5. Changes not staged for commit: modified"></a>5. Changes not staged for commit: modified</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cochona@cochona:~/gitosis-admin$ git commit -m &quot;add shaoc@pub to admin-group&quot;</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with &apos;origin/master&apos;.</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">	modified:   gitosis.conf</span><br><span class="line">	</span><br><span class="line">no changes added to commit</span><br></pre></td></tr></table></figure>
<p>此时如果要保存修改，需要先<code>git add gitosis.conf</code>，然后<code>git commit -m &quot;&quot;</code>,然后<code>git push</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/29/ionic state命令不应该再使用了/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/29/ionic state命令不应该再使用了/" itemprop="url">ionic state命令将要废弃</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-29T11:29:00+08:00">
                2016-12-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ionic-state命令将要废弃"><a href="#ionic-state命令将要废弃" class="headerlink" title="ionic state命令将要废弃"></a>ionic state命令将要废弃</h1><p>参考自官方网站</p>
<p><a href="https://github.com/driftyco/ionic-cli/issues/904" target="_blank" rel="noopener">Discuss: Deprecate/Remove state command #904</a></p>
<p><a href="https://cordova.apache.org/docs/en/latest/platform_plugin_versioning_ref/index.html" target="_blank" rel="noopener">cordova说明</a></p>
<blockquote>
<p>The state command was created to manage Cordova plugins before it was supported in Cordova. Cordova now manages plugins and platforms in config.xml: <a href="https://cordova.apache.org/docs/en/latest/platform_plugin_versioning_ref/index.html" target="_blank" rel="noopener">https://cordova.apache.org/docs/en/latest/platform_plugin_versioning_ref/index.html</a> so there is a decent amount of confusion between the Ionic and Cordova behavior. As Cordova platforms and plugins are not an Ionic concern, let’s deprecate the state command and document the existing Cordova command workflow, ie plugin add –save.</p>
</blockquote>
<p>state命令是之前用来管理cordova插件的。现在Cordova自身已经开始通过<code>config.xml</code>来支持插件和平台管理（<a href="https://cordova.apache.org/docs/en/latest/platform_plugin_versioning_ref/index.html" target="_blank" rel="noopener">官方说明</a>），这会让我们对ionic和cordova的不同的管理方式感到困惑。因为cordova的平台和插件是ionic所不关心的，所以建议停止使用<code>state</code>命令，而使用cordova的管理方式，比如<code>plugin add --save</code></p>
<h2 id="对于插件我们应该这样管理"><a href="#对于插件我们应该这样管理" class="headerlink" title="对于插件我们应该这样管理"></a>对于插件我们应该这样管理</h2><p>重装所有插件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rm -rf plugins</span><br><span class="line"><span class="comment"># 更新插件,执行时会自动安装在config.xml中的插件</span></span><br><span class="line">cordova prepare</span><br></pre></td></tr></table></figure>
<p>从工程中彻底删除一个插件，–save命令会将删除或更改影响到<code>config.xml</code>,与<code>package.json</code>无关</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cordova plugin reomve ionic-plugin-keyboard --save</span><br><span class="line">cordova plugin add ionic-plugin-keyboard --save</span><br></pre></td></tr></table></figure>
<p>platform add的时候会自动检测<code>config.xml</code>，并安装记录的插件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cordova platform add android</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/28/研究了oh-my-zsh中环境变量的配置办法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/28/研究了oh-my-zsh中环境变量的配置办法/" itemprop="url">Mac配置oh-my-zsh</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-28T00:00:00+08:00">
                2016-12-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Mac配置oh-my-zsh"><a href="#Mac配置oh-my-zsh" class="headerlink" title="Mac配置oh-my-zsh"></a>Mac配置oh-my-zsh</h1><h2 id="mac环境变量保存的地方"><a href="#mac环境变量保存的地方" class="headerlink" title="mac环境变量保存的地方"></a>mac环境变量保存的地方</h2><p>没有zsh的时候，mac中的环境变量保存在:</p>
<h4 id="1-etc-profile-（建议不修改这个文件-）"><a href="#1-etc-profile-（建议不修改这个文件-）" class="headerlink" title="1./etc/profile   （建议不修改这个文件 ）"></a>1./etc/profile   （建议不修改这个文件 ）</h4><p> 全局（公有）配置，不管是哪个用户，登录时都会读取该文件。</p>
<h4 id="2-etc-bashrc-（一般在这个文件中添加系统级环境变量）"><a href="#2-etc-bashrc-（一般在这个文件中添加系统级环境变量）" class="headerlink" title="2./etc/bashrc    （一般在这个文件中添加系统级环境变量）"></a>2./etc/bashrc    （一般在这个文件中添加系统级环境变量）</h4><p> 全局（公有）配置，bash shell执行时，不管是何种方式，都会读取此文件。</p>
<h4 id="3-bash-profile-（一般在这个文件中添加用户级环境变量）"><a href="#3-bash-profile-（一般在这个文件中添加用户级环境变量）" class="headerlink" title="3.~/.bash_profile  （一般在这个文件中添加用户级环境变量）"></a>3.~/.bash_profile  （一般在这个文件中添加用户级环境变量）</h4><p> 每个用户都可使用该文件输入专用于自己使用的shell信息,当用户登录时,该文件仅仅执行</p>
<p>如果要修改环境变量，一般修改<code>~/.bash_profile</code>就行了。</p>
<h2 id="查看环境变量"><a href="#查看环境变量" class="headerlink" title="查看环境变量"></a>查看环境变量</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ printenv</span><br></pre></td></tr></table></figure>
<p>查看当前使用的shell</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo $SHELL</span><br><span class="line">    /bin/zsh</span><br></pre></td></tr></table></figure>
<h2 id="zsh安装后"><a href="#zsh安装后" class="headerlink" title="zsh安装后"></a>zsh安装后</h2><p>安装zsh后，默认情况下就不会自动读取<code>~/.bash_profile</code>了。<br>在用户目录下应该有<code>.oh-my-zsh</code>目录，和<code>.zshrc</code>配置文件</p>
<ol>
<li><p><code>.oh-my-zsh</code>目录： 它是zsh的安装文件夹，可以自己更改</p>
</li>
<li><p><code>.zshrc</code>: 里面是zsh默认配置，可以用于设置环境变量（export），alias命令别名，设置主题等</p>
<blockquote>
<p>但是zsh不建议直接操作这个默认配置，如果用户需要自定义配置，推荐去这里<code>./oh-my-zsh/custom/custom.zsh</code>修改。注意：<code>custom</code>文件夹里的所有配置都会被zsh自动读取并配置。</p>
</blockquote>
</li>
<li><p><code>./oh-my-zsh/custom/my_custom.zsh</code>:用户设置自定义系统变量、自定义命令等等</p>
<p> 一般情况下，我们在<code>./oh-my-zsh/custom/my_custom.zsh</code>中配置一个快捷键</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alias zshconfig=&quot;subl ~/.oh-my-zsh/custom/my_custom.zsh&quot;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="综上，如果要配置环境变量的步骤"><a href="#综上，如果要配置环境变量的步骤" class="headerlink" title="综上，如果要配置环境变量的步骤"></a>综上，如果要配置环境变量的步骤</h2><ol>
<li>执行<code>zshconfig</code>,会自动使用你定义的命令，打开配置文件</li>
<li>在该文件中添加你想要添加的环境变量，比如<code>export ANDROID_HOME=/Development/android-sdk/</code></li>
<li>重启cmd，生效！OK。配置完成</li>
</ol>
<h2 id="备份一个我自己的配置文件"><a href="#备份一个我自己的配置文件" class="headerlink" title="备份一个我自己的配置文件"></a>备份一个我自己的配置文件</h2><p><code>./oh-my-zsh/custom/my_custom.zsh</code>如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alias zshconfig=&quot;subl ~/.oh-my-zsh/custom/my_custom.zsh&quot;</span><br><span class="line">alias code=\&apos;&apos;/Applications/Visual Studio Code.app/Contents/Resources/app/bin/code&apos;\&apos;</span><br><span class="line">alias subl=&quot;&apos;/Applications/Sublime Text.app/Contents/SharedSupport/bin/subl&apos;&quot;</span><br><span class="line">alias nano=&quot;subl&quot;</span><br><span class="line">alias sl=&quot;subl&quot;</span><br><span class="line">alias py=&quot;python&quot;</span><br><span class="line">alias nw=&quot;/Applications/nwjs.app/Contents/MacOS/nwjs&quot;</span><br><span class="line">export ANDROID_HOME=/Development/android-sdk/</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/26/vscode中beautifyrc插件配置文件翻译和设置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/26/vscode中beautifyrc插件配置文件翻译和设置/" itemprop="url">vscode中beautifyrc插件配置文件翻译和设置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-26T23:08:09+08:00">
                2016-12-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="vscode中beautifyrc插件配置文件翻译和设置"><a href="#vscode中beautifyrc插件配置文件翻译和设置" class="headerlink" title="vscode中beautifyrc插件配置文件翻译和设置"></a>vscode中beautifyrc插件配置文件翻译和设置</h1><p>2016-12-26 23:08:09</p>
<p>在 VisualStudio Code 中有<code>beautify</code>插件，用来格式化代码，下面是研究它的一些配置说明，一些英文缩写还是很难一眼看懂的，下面记录下来。</p>
<p>顺便给出一个英文的设置说明：<a href="https://github.com/HookyQR/VSCodeBeautify/blob/master/Settings.md" target="_blank" rel="noopener">https://github.com/HookyQR/VSCodeBeautify/blob/master/Settings.md</a>.英文好的话，直接去看就行啦。</p>
<p>配置说明：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"indent_size"</span>: <span class="number">4</span>,      <span class="comment">//缩进大小，默认4</span></span><br><span class="line">    <span class="string">"indent_char"</span>: <span class="string">" "</span>,    <span class="comment">//缩进字符，默认" "</span></span><br><span class="line">    <span class="string">"eol"</span>: <span class="string">"\n"</span>,           <span class="comment">//end of line，行结尾字符"\n"</span></span><br><span class="line">    <span class="string">"indent_level"</span>: <span class="number">0</span>,     <span class="comment">//初始缩进级别</span></span><br><span class="line">    <span class="string">"indent_with_tabs"</span>: <span class="literal">false</span>, <span class="comment">//使用tab缩进，将会覆盖“indent_size”和“indent_char”设置，默认false</span></span><br><span class="line">    <span class="string">"preserve_newlines"</span>: <span class="literal">true</span>,       <span class="comment">//保留空行，默认“true”</span></span><br><span class="line">    <span class="string">"max_preserve_newlines"</span>: <span class="number">10</span>,     <span class="comment">//一次最多保留多少行的空行，默认10</span></span><br><span class="line">    <span class="string">"jslint_happy"</span>: <span class="literal">false</span>,           <span class="comment">//开启jslint-stricter的严格模式（强制开启“space_after_anon_function”选项）,默认false</span></span><br><span class="line">    <span class="string">"space_after_anon_function"</span>: <span class="literal">false</span>, <span class="comment">//在匿名函数前自动加一个空格，比如`function ()&#123;&#125;`，默认false</span></span><br><span class="line">    <span class="string">"brace_style"</span>: <span class="string">"collapse"</span>,          <span class="comment">//括号风格，"collapse-preserve-inline", "collapse", "expand", "end-expand", or "none" ,默认“collapse”</span></span><br><span class="line">    <span class="string">"keep_array_indentation"</span>: <span class="literal">false</span>,    <span class="comment">//保持数组缩进，默认false</span></span><br><span class="line">    <span class="string">"keep_function_indentation"</span>: <span class="literal">false</span>, <span class="comment">//保持函数缩进，默认false</span></span><br><span class="line">    <span class="string">"space_before_conditional"</span>: <span class="literal">true</span>,   <span class="comment">//在条件语句之前保留一个空格，默认true</span></span><br><span class="line">    <span class="string">"break_chained_methods"</span>: <span class="literal">false</span>,     <span class="comment">//中断多行间的链式方法调用，默认true</span></span><br><span class="line">    <span class="string">"eval_code"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"unescape_strings"</span>: <span class="literal">false</span>,      <span class="comment">//解码用xNN编码的可打印字符，默认false</span></span><br><span class="line">    <span class="string">"wrap_line_length"</span>: <span class="number">0</span>,          <span class="comment">//Wrap lines at next opportunity after N characters. (Set zero to ignore wrapping),默认0,下次在n个字符后换行</span></span><br><span class="line">    <span class="string">"wrap_attributes"</span>: <span class="string">"auto"</span>,        <span class="comment">//将html属性标签放在新行“auto”,“force”,默认auto</span></span><br><span class="line">    <span class="string">"wrap_attributes_indent_size"</span>: <span class="number">4</span>, <span class="comment">//html属性标签新行缩进字符数，默认为"indent_size"4</span></span><br><span class="line">    <span class="string">"end_with_newline"</span>: <span class="literal">false</span>         <span class="comment">//在文件结尾保证有换行，默认false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>indentation 缩进</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/17/ReactNative环境安装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/17/ReactNative环境安装/" itemprop="url">ReactNative环境安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-17T13:04:53+08:00">
                2016-12-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ReactNative环境安装"><a href="#ReactNative环境安装" class="headerlink" title="ReactNative环境安装"></a>ReactNative环境安装</h2><p>2016年12月17日13:04:16</p>
<p>在安装rn，初始化rn应用，以及npm install rn工程的时候，要尽量注意做到使用<code>npm</code>，不要使用<code>cnpm</code>代替，可能会出现未知的错误。</p>
<h3 id="1-安装node、配置镜像加速"><a href="#1-安装node、配置镜像加速" class="headerlink" title="1.安装node、配置镜像加速"></a>1.安装node、配置镜像加速</h3><p>node安装过程略。</p>
<p>建议一定要设置镜像来加速，不然速度会很慢：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org --global</span><br><span class="line">npm config <span class="built_in">set</span> disturl https://npm.taobao.org/dist --global</span><br></pre></td></tr></table></figure>
<h3 id="2-安装rn和yarn"><a href="#2-安装rn和yarn" class="headerlink" title="2.安装rn和yarn"></a>2.安装rn和yarn</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -g yarn react-native-cli</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Yarn是Facebook提供的替代npm的工具，可以加速node模块的下载。React Native的命令行工具用于执行创建、初始化、更新项目、运行打包服务（packager）等任务。</p>
</blockquote>
<p>如果出现错误，考虑修改权限</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo chown -R `whoami` /usr/local</span><br></pre></td></tr></table></figure>
<h3 id="3-选择安装"><a href="#3-选择安装" class="headerlink" title="3.选择安装"></a>3.选择安装</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">brew install watchman</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Watchman是由Facebook提供的监视文件系统变更的工具，安装此工具，packager可以快速捕捉文件的变化从而实现实时刷新，提高效率。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">brew install flow</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Flow是一个静态的JS类型检查工具,它只是Facebook自家的代码规范。新手可以选择跳过。</p>
</blockquote>
<h3 id="4-新建测试项目"><a href="#4-新建测试项目" class="headerlink" title="4.新建测试项目"></a>4.新建测试项目</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">react-native init AwesomeProject</span><br><span class="line">cd AwesomeProject</span><br><span class="line">react-native run-ios</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/08/The-Advantages-of-Progressive-Web-Apps-in-the-Modern-Mobile-Environment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/08/The-Advantages-of-Progressive-Web-Apps-in-the-Modern-Mobile-Environment/" itemprop="url">渐进式Web应用程序在现代移动环境中的优势</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-08T19:16:19+08:00">
                2016-12-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/翻译/" itemprop="url" rel="index">
                    <span itemprop="name">翻译</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>渐进式Web应用程序在现代移动环境中的优势<br>The Advantages of Progressive Web Apps in the Modern Mobile Environment</p>
<blockquote>
<p>文章翻译自：<a href="http://blog.ionic.io/the-advantages-of-pwas/" target="_blank" rel="noopener">http://blog.ionic.io/the-advantages-of-pwas/</a><br>2016/12/1，作者：<a href="http://twitter.com/@Justinwillis96" target="_blank" rel="noopener">Justin</a>，译者：shaochong</p>
</blockquote>
<p>我们一直在谈论Progressive Web Apps（下文简称PWA）- 它是用现代化的web API如<code>service workers</code>，<code>web manifest</code>和<code>web push</code>来构建的web应用程序，让人们在浏览器中就可以体验到和本地程序一样棒的使用体验。</p>
<blockquote>
<p>我来解释几个概念（译者注）<br><code>service workers</code>是啥玩意？你可以这么理解，它运行于你当前页面主线程外的另一个线程中，用来加速你的APP，以它独特的技术来建立高效的离线体验，拦截网络请求，并且会根据当前的网络是否可用、服务器的内容是否更新来采取合适的策略。他们还允许通知推送和后台同步API。更多请参见MDN <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API" target="_blank" rel="noopener">Service Workers</a>。<br><code>web manifest</code>又是啥玩意？它提供了一个文本文件的应用程序（如名称，作者，图标和描述）的信息，其目的是安装Web应用程序到设备的主屏幕，提供更快速、更丰富的用户体验。更多参见MDN <a href="https://developer.mozilla.org/en-US/docs/Web/Manifest" target="_blank" rel="noopener">Web App Manifest</a>。<br><code>web push</code>是什么鬼？Web Push API让web应用有了可以接受来自服务端推送来的消息的能力，无论web应用是否在前台运行，甚至是否加载完成。这让开发者可以实现异步通知和更新，及时的数据更新会让用户有更好的参与感。更多请参见<a href="https://developer.mozilla.org/en-US/docs/Web/API/Push_API" target="_blank" rel="noopener">Push API</a></p>
</blockquote>
<h3 id="全新的移动环境"><a href="#全新的移动环境" class="headerlink" title="全新的移动环境"></a>全新的移动环境</h3><p>在我们谈论PWA的优势之前，有一件很重要的事情，那就是要搞清楚现在的移动环境和我们过去的开发环境有什么不同的地方。随着发展中国家越来越多的人能够通过他们的移动设备访问互联网，我们也要准备好为他们构建app，就像为在旧金山使用iphone7的人一样。<br>一，这些用户主要是通过2G或这3G来上网，它们网速很糟糕。<br>二，他们的设备通常有1-2G的RAM，慢速四核CPU，4GB的磁盘存储空间，运行android5.0或更高。<br>三，移动数据上网费用还是很昂贵的。到2016年，印度1GB移动数据平均成本为3.81美元，而最低工资为每小时31美分。这是一个很具有挑战性的应用场合，但是通过PWA我们仍然可以构建很棒、用户体验很好的应用程序。</p>
<h3 id="为什么PWAs在现代移动环境中有着无与伦比的优势"><a href="#为什么PWAs在现代移动环境中有着无与伦比的优势" class="headerlink" title="为什么PWAs在现代移动环境中有着无与伦比的优势"></a>为什么PWAs在现代移动环境中有着无与伦比的优势</h3><p>和本地原生应用相比，PWA有三个关键的特点，让它能够构建功能更完善、用户体验更好的应用程序。</p>
<ul>
<li>高效的使用磁盘空间</li>
<li>高效的使用网络</li>
<li>不需要一次性安装大型的安装包</li>
</ul>
<p>Service workers可以帮我们完成这三个工作。<br>举个例子来说，service workers 能够让我们动态的缓存资源到本地设备，所以即使是在慢速、糟糕的网络环境中，我们仍能够提供很好的使用体验。这里的关键点是动态缓存。这意味着在慢速糟糕的网络环境中，我们可以优先缓存那些对程序来说最重要的资源，而无需去下载一个大的APK文件。比如，对于一个电商app，你可能不希望将app中的每一个产品页都缓存到本地。我们仅仅需要将那些之前浏览过的产品页和app启动所必须的资源文件缓存到本地。<br>此外，由于是网站的工作方式，用户不必一次性的下载大的app文件。他们只需要下载他们所访问的PWA页面，并且通过使用service worker的动态缓存，我们可以选择仅缓存我们PWA应用的重要页面，因此这些页面只需要下载一次即可。我们可以通过Flipkart PWA来看看实际效果。在我的Nexus6上，他占用了大约351KB的存储空间。而在同一台设备上，Twitter的应用程序占用了69.36MB。如你所见，差距很大，在那些只有4G存储空间的设备上，差距将更加明显。</p>
<h3 id="Ionic对于PWA的计划"><a href="#Ionic对于PWA的计划" class="headerlink" title="Ionic对于PWA的计划"></a>Ionic对于PWA的计划</h3><p>目前在ionic中支持对PWA的开箱即用，而且在不久的将来我们将会使它的支持更加强大。我们现在默认提供一个service worker和web manifest，让你的ionic应用具有PWA应用的能力，比如离线缓存，浏览器提示添加到主屏幕等。<br>此外，由于ionic是使用纯web技术来构建的，所以它可以很好的在浏览器中工作。展望未来，我们已经致力于通过代码拆分（code splitting），树形目录（treeshaking）和属性重命名（property renaming）来使我们的捆绑包更小，这可以让你的ionic2应用运行的更快。我们知道，在移动网络上，加载时间是很重要的，相信通过这些改变，我们可以更好的满足这一点。<br>使用Progressive Web Apps和现代化网络的强大功能，即使在低端，便宜的设备上，我们也能提供出色的用户体验。 PWA为移动应用程序提供了全新的范例，这对新的移动环境至关重要。 下次当你有一个极好的构思和想法，而且想要把它构建为移动app的时候，考虑将其构建为一个PWA应用，这可以让你的app触及到下一个十亿级的用户群体。</p>
<blockquote>
<p>译者：shaochong</p>
<p>E-mail：hao5743@163.com</p>
<p>博客：<a href="http://hao5743.github.io/" target="_blank" rel="noopener">http://hao5743.github.io/</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/05/在angular1中自定义directive时数据显示不同步问题的分析和解决/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/05/在angular1中自定义directive时数据显示不同步问题的分析和解决/" itemprop="url">在angular1中自定义directive时数据显示不同步问题的分析和解决</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-05T16:33:38+08:00">
                2016-12-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Angular/" itemprop="url" rel="index">
                    <span itemprop="name">Angular</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="在angular1中自定义directive时数据显示不同步问题的分析和解决"><a href="#在angular1中自定义directive时数据显示不同步问题的分析和解决" class="headerlink" title="在angular1中自定义directive时数据显示不同步问题的分析和解决"></a>在angular1中自定义directive时数据显示不同步问题的分析和解决</h1><p>2016-12-05 16:33:38</p>
<p>在angular1项目中，有的时候我们需要写<code>自定义directive</code>来完成某些应用逻辑，但是如果你有过一些的angular1项目的开发经验，肯定会因为一些莫名其妙数据双向绑定，回调函数无法调用执行等问题，困扰过。下面是一个简单的案例。</p>
<h3 id="问题引出"><a href="#问题引出" class="headerlink" title="问题引出"></a>问题引出</h3><p>这里我们写一个简单的<code>directive</code>来说明问题。</p>
<p>directive.js</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">angular.module(&apos;app.directive&apos;)</span><br><span class="line">.directive(&apos;ayTest&apos;,function()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        restrict: &apos;EA&apos;,</span><br><span class="line">        scope: &#123;</span><br><span class="line">            name:&apos;=&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">        template:`</span><br><span class="line">            &lt;div class=&quot;padding mystyle&quot;&gt;</span><br><span class="line">                &#123;&#123;vm.name&#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        `,</span><br><span class="line">        controller:function($scope)&#123;</span><br><span class="line">            var vm = $scope.vm = &#123;&#125;;</span><br><span class="line">            vm.name = $scope.name;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>A.controller.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = $scope.vm = &#123;&#125;;</span><br><span class="line">   vm.name = <span class="string">'Tom1'</span>;</span><br><span class="line">   $timeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       vm.name = <span class="string">'Tom2'</span>;</span><br><span class="line">   &#125;,<span class="number">1000</span>);</span><br><span class="line">   $timeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       vm.name = <span class="string">'Tom3'</span>;</span><br><span class="line">   &#125;,<span class="number">2000</span>);</span><br></pre></td></tr></table></figure>
<p>A.html</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;ay-test name=&quot;vm.name&quot;&gt;&lt;/ay-test&gt;</span><br></pre></td></tr></table></figure>
<p>这个directive可以实现以我们自己的格式展示‘name’的功能，我们可以通过在template中填写自己独有的style或者嵌套div来完善name展示模块。</p>
<p>在这我们希望<code>name</code>能够实现双向绑定，即当在A页面中<code>name</code>值发生变化的时候，directive也自动获得更改。</p>
<p>但是，在这里并不能实现这个功能，当<code>name</code>显示为<code>Tom1</code>之后，就不会再变化了。</p>
<p>###为什么会这样呢？</p>
<p>我们都知道自定义directive时，有3个绑定符号，分别是</p>
<ul>
<li><code>@</code> 单向绑定属性值</li>
<li><code>=</code> 双向绑定属性</li>
<li><code>&amp;</code> 绑定用户函数</li>
</ul>
<p>这里为了实现信息的双向绑定，已经使用了<code>=</code>，为什么还无法完成双向绑定呢？对于大神们，当然能一眼看出问题的所在，但小白可能会摸索比较长的时间~~~~</p>
<p><em>问题出在<code>vm.name = $scope.name;</code>这句代码上</em>。因为name是一个基本字符串，赋值时，相当于对vm.name创建了一个新值，并赋值为<code>$scope.name</code>的值。这样，虽然controller中的<code>$scope.name</code>和页面上的<code></code>仍存在双向绑定，但是和我们的<code>vm.name</code>却无任何关系了。</p>
<p>我们应该还知道下面的这个问题：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//controller.js</span><br><span class="line">$socpe.username = &apos;Mary&apos;;</span><br><span class="line">//B.html</span><br><span class="line">&lt;input ng-model=&apos;username&apos; /&gt;</span><br></pre></td></tr></table></figure>
<p>如果你按照上面的方式来编码，十有八九会出现意外情况。</p>
<p>出现这样错误的根本原因，其实还是对JavaScript变量的值访问、引用访问，开发中的值传递、引用传递没有理解清楚。下面说一些这方面的问题。</p>
<h3 id="Js基本类型、值传递"><a href="#Js基本类型、值传递" class="headerlink" title="Js基本类型、值传递"></a>Js基本类型、值传递</h3><p>下面是笔者摘自《JavaScript高级程序设计》中的几段话，读者可以参照理解。这里并不是笔者自己懒，而书中的表达更准确，而且也很容易理解~~(如果你说不知道这本书，推荐快去读一下，如果你做Js相关开发，会让你受益匪浅，我能给你电子版，联系<code>hao5743@163.com</code> )</p>
<blockquote>
<p>5种基本数据类型：Undefined、Null、Boolean、Number和String，<strong>5种基本数据类型是按值访问</strong>的，因为可以操作保存在变量中的实际的值。</p>
<p>引用类型的值是保存在内存中的对象。于其他语言不同，JavaScript不允许直接访问内存中的位置，也就是说不能直接操作对象的内存空间。在操作对象时，实际上是在操作对象的引用而不是实际的对象。<strong>引用类型的值是按引用访问</strong>的。</p>
<p>–<em>参见《JavaScript高级程序设计》P69 4.1 基本类型和引用类型的值</em></p>
<p>如果从一个变量向另一个变量复制基本类型的值，会在变量对象上创建一个新值，然后把该值复制到为新变量分配的位置上。</p>
<p>–<em>参见《JavaScript高级程序设计》P69 4.1.2 复制变量值</em></p>
<p><strong>ECMAScript中所有函数的参数都是按值传递的</strong>。也就是说，把函数外部的值赋值给函数内部的参数，就和把值从一个变量复制到另一个变量一样。基本类型值的传递如同基本类型变量的复制一样，二引用类型值的传递，则如同引用类型变量的复制一样。有不少开发人员在这一点可能会感到困惑，因为访问变量有按值和按引用两种方式，而参数只能按值传递。</p>
<p>–<em>参见《JavaScript高级程序设计》P70 4.1.3 传递参数</em></p>
</blockquote>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>理解了上面的话，那么你就能轻易用不同的方案解决这个问题了。</p>
<h4 id="方案1-直接使用-scope-name展示数据"><a href="#方案1-直接使用-scope-name展示数据" class="headerlink" title="方案1 直接使用$scope.name展示数据"></a>方案1 直接使用<code>$scope.name</code>展示数据</h4><p>directive.js</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">angular.module(&apos;app.directive&apos;)</span><br><span class="line">.directive(&apos;ayTest&apos;,function()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        restrict: &apos;EA&apos;,</span><br><span class="line">        scope: &#123;</span><br><span class="line">            name:&apos;=&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">        //这里直接使用name，不再使用vm.name</span><br><span class="line">        template:`</span><br><span class="line">            &lt;div class=&quot;padding mystyle&quot;&gt;</span><br><span class="line">                &#123;&#123;name&#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        `,</span><br><span class="line">        controller:function($scope)&#123;</span><br><span class="line">            var vm = $scope.vm = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>不再使用vm的方式，而是直接绑定到页面，可以解决问题。</p>
<h4 id="方案2-使用引用类型打包基本类型再传递"><a href="#方案2-使用引用类型打包基本类型再传递" class="headerlink" title="方案2 使用引用类型打包基本类型再传递"></a>方案2 使用引用类型打包基本类型再传递</h4><p>如果，你在angular1开发中，一直遵循了好的实践，那么有可能<code>vm.name</code>你可能已经使用习惯了。也许你会问，如果我还想使用<code>vm.name</code>的方式，我想遵循官方给出的最佳实践，怎么解决这个问题呢？</p>
<blockquote>
<p>（什么是最佳实践？如果你是angular开发者，而还不知道的话，那么一定要去读读，原版<a href="https://github.com/johnpapa/angular-styleguide/blob/master/a1/README.md" target="_blank" rel="noopener">在这里</a>，英文差的<a href="http://www.tuicool.com/articles/JbuErq" target="_blank" rel="noopener">看这里</a>）</p>
</blockquote>
<p>当然有方法啦！看下面<br>controller.js</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var vm = $scope.vm = &#123;&#125;;</span><br><span class="line">vm.name = &#123;&#125;;</span><br><span class="line">//将数据封装到到内部属性data上</span><br><span class="line">vm.name.data = &apos;Tom1&apos;;</span><br><span class="line">$timeout(function()&#123;</span><br><span class="line">    vm.name.data = &apos;Tom2&apos;;</span><br><span class="line">&#125;,1000);</span><br><span class="line">$timeout(function()&#123;</span><br><span class="line">    vm.name.data = &apos;Tom3&apos;;</span><br><span class="line">&#125;,2000);</span><br></pre></td></tr></table></figure>
<p>A.html</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;ay-test name=&quot;vm.name&quot;&gt;&lt;/ay-test&gt;</span><br></pre></td></tr></table></figure>
<p>directive.js</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.directive(&apos;ayTest&apos;,function()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        restrict: &apos;EA&apos;,</span><br><span class="line">        scope: &#123;</span><br><span class="line">            name:&apos;=&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">        template:`</span><br><span class="line">            &lt;div class=&quot;padding&quot;&gt;</span><br><span class="line">                &#123;&#123;vm.name.data&#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        `,</span><br><span class="line">        controller:function($scope)&#123;</span><br><span class="line">            var vm = $scope.vm = &#123;&#125;;</span><br><span class="line">            //注意，虽然这里重新赋值了name,但是我们的vm.name.data还是同一份，所以仍能实现绑定</span><br><span class="line">            vm.name = $scope.name;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="方案3-使用-scope-watch"><a href="#方案3-使用-scope-watch" class="headerlink" title="方案3 使用$scope.$watch"></a>方案3 使用<code>$scope.$watch</code></h4><p>如果你知道<code>$scope.$watch</code>，并且了解何时使用它，那么你应该知道这里也可能使用它来解决。看代码。</p>
<p>controller.js</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var vm = $scope.vm = &#123;&#125;;</span><br><span class="line">//并没有进行数据封装</span><br><span class="line">vm.name = &apos;Tom1&apos;;</span><br><span class="line">$timeout(function()&#123;</span><br><span class="line">    vm.name = &apos;Tom2&apos;;</span><br><span class="line">&#125;,1000);</span><br><span class="line">$timeout(function()&#123;</span><br><span class="line">    vm.name = &apos;Tom3&apos;;</span><br><span class="line">&#125;,2000);</span><br></pre></td></tr></table></figure>
<p>A.html</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;ay-test name=&quot;vm.name&quot;&gt;&lt;/ay-test&gt;</span><br></pre></td></tr></table></figure>
<p>directive.js</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">angular.module(&apos;app.directive&apos;)</span><br><span class="line">.directive(&apos;ayTest&apos;,function()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        restrict: &apos;EA&apos;,</span><br><span class="line">        scope: &#123;</span><br><span class="line">            name:&apos;=&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">        template:`</span><br><span class="line">            &lt;div class=&quot;padding&quot;&gt;</span><br><span class="line">                &#123;&#123;vm.name&#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        `,</span><br><span class="line">        controller:function($scope)&#123;</span><br><span class="line">            var vm = $scope.vm = &#123;&#125;;</span><br><span class="line">            //添加数据监测</span><br><span class="line">            $scope.$watch(&apos;name&apos;,function(newValue,oldValue)&#123;</span><br><span class="line">                vm.name = $scope.name;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这个方法其实相当于多加了一层的监测，<code>vm.name</code>和页面上的<code></code>绑定，通过<code>$scope.$watch</code>，我们让<code>vm.name</code>和<code>$scope.name</code>两个变量的值保持一致性。</p>
<h4 id="哪个方法好呢"><a href="#哪个方法好呢" class="headerlink" title="哪个方法好呢"></a>哪个方法好呢</h4><p>个人推荐第一种方法，因为他所做的工作最少，效率相对较高（虽然高不了很多）。</p>
<h3 id="最后的话"><a href="#最后的话" class="headerlink" title="最后的话"></a>最后的话</h3><p>本文首先提出了在编写自定义directive时有时候会出现的数据无法同步的问题。随后分析了问题，并给出了几种解决方案。</p>
<p>其实，问题的根本首先在于对JavaScript变量<code>值访问</code>、<code>引用访问</code>和<code>值传递</code>等概念的理解，其次在于对angular1<code>scope层级</code>、<code>双向绑定</code>、<code>脏值检测</code>等概念的理解。</p>
<p>有时，还能需要处理其他情况，比如默认值处理，分条件展示，错误值处理、数据回显、回调函数处理等具体问题，可以参考上面3种思路来具体实现。</p>
<p>很简单一个问题，个人只是做了一下分析，有错误的地方请大神及时指出，感激不尽~~</p>
<blockquote>
<p>Author：shaochong</p>
<p>Email：hao5743@163.com</p>
<p>文章地址：<a href="https://hao5743.github.io/2016/12/05/Data-bind-problem-in-Angular-when-define-your-own-directives/" target="_blank" rel="noopener">https://hao5743.github.io/2016/12/05/Data-bind-problem-in-Angular-when-define-your-own-directives/</a></p>
<p>博客：<a href="http://hao5743.github.io/" target="_blank" rel="noopener">http://hao5743.github.io/</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/03/Handling-CORS-issues-in Ionic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Hunt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="易天行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/03/Handling-CORS-issues-in Ionic/" itemprop="url">彻底解决Ionic项目中的跨域问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-03T18:38:17+08:00">
                2016-12-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ionic/" itemprop="url" rel="index">
                    <span itemprop="name">ionic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在<code>ionic</code>项目中，如果你使用<code>ionic serve</code>或者<code>ionic run</code>,并且开启了动态加载（live reload），且访问了远端服务器的API，那么你就可能会遇到 <a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing" target="_blank" rel="noopener">跨域资源共享(CORS)</a> 问题。出现类似下面的错误提示：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">XMLHttpRequest cannot load http://api.ionic.com/endpoint.</span><br><span class="line">No &apos;Access-Control-Allow-Origin&apos; header is present on the requested resource.</span><br><span class="line">Origin &apos;http://localhost:8100&apos; is therefore not allowed access.</span><br></pre></td></tr></table></figure></p>
<p>那么，什么是CORS？ 为什么在这里会发生这个错误呢？</p>
<h2 id="什么是CORS？"><a href="#什么是CORS？" class="headerlink" title="什么是CORS？"></a>什么是CORS？</h2><p>CORS = Cross origin resource sharing <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener">跨域资源共享</a><br><code>origin</code>是你当前所在页面的主机地址。<br>如果你在浏览<code>http://ionicframework.com/blog/handling-cors-issues-in-ionic</code>页面，它的<code>origin</code>就是<code>ionicframework.com</code>。在此页面上，如果你要向<code>http://cors.api.com/api</code>发送一个<a href="https://developer.mozilla.org/zh-CN/docs/AJAX/Getting_Started" target="_blank" rel="noopener">AJAX</a>请求,您的主机源将由Origin标头指定，该标头会自动包含在浏览器的CORS请求中。因为<code>ionicframework.com</code>和主机<code>api.com</code>并不匹配，我们从<code>ionicframework.com</code>的请求必须要经过服务器的批准，才能够访问该资源，以Http Options请求头的形式。</p>
<p>如果我们遇到了上面的错误，说明服务器没有给我们的地址<code>ionicframework.com</code>赋予访问该资源的权限。</p>
<p>下面来看一下，当通过<code>ionic serve</code>,<code>ionic run</code>,<code>ionic run -l</code>三种不同方式运行app时，你的<code>origin</code>分别是什么？</p>
<h3 id="在浏览器中运行时"><a href="#在浏览器中运行时" class="headerlink" title="在浏览器中运行时"></a>在浏览器中运行时</h3><p>在执行<code>ionic serve</code>时，发生了什么？</p>
<ul>
<li>启动了一个本地web服务器</li>
<li>你的浏览器自动打开了指向本地服务器地址的一个页面</li>
</ul>
<p>这时你可以看到你的app加载到了你的浏览器上，地址是<code>http://localhost:8100</code>(如果你选择了localhost)。</p>
<p>这时，你的<code>origin</code>是<code>localhost:8100</code>。</p>
<p>任何发送到主机而不是<code>localhost:8100</code>的AJAX请求，都将以<code>localhost:8100</code>作为其<code>origin</code>，因此需要经过CORS预检请求，来查看是否有权限访问该资源。</p>
<h3 id="在设备上运行时"><a href="#在设备上运行时" class="headerlink" title="在设备上运行时"></a>在设备上运行时</h3><p>当执行<code>ionic run</code>时，又发生了些什么呢？</p>
<ul>
<li>应用程序文件被复制到设备（或模拟器）。</li>
<li>app开始运行，然后启动一个设备（或模拟器）上的浏览器来打开这些文件，类似<code>file://some/path/www/index.html</code></li>
</ul>
<p>这样，你的<code>origin</code>将不存在了，因为你正在运行于一个文件（<code>file://</code>）URI。理所当然，你的任何向外请求将不需要通过CORS预检。</p>
<h3 id="在设备上通过自动加载（livereload）运行时"><a href="#在设备上通过自动加载（livereload）运行时" class="headerlink" title="在设备上通过自动加载（livereload）运行时"></a>在设备上通过自动加载（livereload）运行时</h3><p>执行<code>ionic run -l</code>时，又将发生什么呢？</p>
<ul>
<li>首先启动一个本地web服务器</li>
<li>设备（或模拟器）上app开始运行，启动一个浏览器来开地址<code>http://192.168.1.1:8100</code>（你的本地IP地址）上的文件。</li>
</ul>
<p>这时，你的<code>origin</code>是<code>192.168.1.1:8100</code>。</p>
<p>任何发送到主机而不是<code>192.168.1.1:8100</code>的AJAX请求，都将以<code>192.168.1.1:8100</code>作为其<code>origin</code>，因此需要经过CORS预检请求，来查看是否有权限访问该资源。</p>
<h2 id="在Ionic中处理CORS问题"><a href="#在Ionic中处理CORS问题" class="headerlink" title="在Ionic中处理CORS问题"></a>在Ionic中处理CORS问题</h2><p>CORS问题仅仅发生在，当我们以<code>ionic serve</code>或<code>ionic run -l</code>来运行或测试app的时候。</p>
<p>有2种方法来解决这个问题.</p>
<p>第一种，比较容易的方法，是设置远端服务器，让它可以接受所有源的请求。第二种，有时候我们没有权限去修改远端服务器，此时就需要一个不指定源的请求。</p>
<p>我们可以使用代理服务器来实现这个方案。<code>ionic cli</code>给我们提供了一个很方便的配置代理服务器的方法，下面我们看一下如何来实现。</p>
<h2 id="Ionic-CLI代理服务器"><a href="#Ionic-CLI代理服务器" class="headerlink" title="Ionic CLI代理服务器"></a>Ionic CLI代理服务器</h2><p>下面是关于代理（proxy）的一个定义：</p>
<blockquote>
<p>In computer networks, a proxy server is a server (a computer system or an application) that acts as an intermediary for requests from clients seeking resources from other servers.</p>
<p>在计算机网络中，代理服务器是一个客户端请求的中介服务器（计算机系统或应用），它用于帮助客户端寻找位于其他服务器上的资源。</p>
</blockquote>
<p>要解决我们在ionic中遇到的CORS问题，我们需要设置一个代理服务器，它接受我们的请求，并向API端点发出新的请求，然后接受响应，并将其转发回我们的应用程序。</p>
<p>由于代理服务器需要向目标发送新的请求，因此请求中将不会有<code>origin</code>(源)，也就不再需要CORS了。 需要非常注意一点是，<strong><code>origin</code>是浏览器自动帮我们添加在请求头中的</strong>。</p>
<p>Ionic CLI具有为客户端请求设置代理服务器的能力，用来帮助您解决CORS问题，下面来看一下Ionic CLI设置代理的方法。</p>
<h2 id="设置代理服务器"><a href="#设置代理服务器" class="headerlink" title="设置代理服务器"></a>设置代理服务器</h2><p>再次说明一下，仅仅在<code>ionic serve</code>或<code>ionic run -l</code>的时候需要设置代理。</p>
<p>首先，我们需要在<code>ionic.project</code>（注意，ionic2 cli新版本已经将此文件重命名为<code>ionic.config.json</code>）配置文件中设置代理。 这将告诉Ionic本地服务器监听这些路径并将这些请求转发到目标网址。</p>
<p>在app中，我们需要替换包含endpoint的URLS，并设置为我们的代理服务器地址。（In our app, we will need to replace our endpoint URLS to be set to the proxy server address for when we are running serve or run -l.）</p>
<blockquote>
<p>什么是<code>endpoint</code>？</p>
<p>在项目中 endpoint有时也写作baseUrl，比如这个<code>http://cors.api.com/api/book/2/detail</code>的endpoint是<code>http://cors.api.com/api</code>，再比如<code>http://localhost:8101/api/user/123</code>的endpoint是<code>http://localhost:8101/api</code>。</p>
<p>笔者没有想到好的中文来替代这个英文单词，所以没有进行翻译，希望小伙伴们能够理解它的意思就好啦<del>~</del></p>
</blockquote>
<p>我们可以通过设置一些<em>gulp任务</em>，用gulp中的替换模块(replace)来替换出这些URLS，来简化这一步骤。</p>
<p>比较推荐的方法是设置一个Angular Constant来同一设置的endpoint，方便统一进行修改和维护。</p>
<p>下面是操作步骤。我们需要设置一个Angular Service ApiEndpoint来获取数据。</p>
<h2 id="配置代理地址"><a href="#配置代理地址" class="headerlink" title="配置代理地址"></a>配置代理地址</h2><p>配置代理有两个需要注意的地方。</p>
<ul>
<li><code>path</code>：你在本地Ionic服务器上访问它们的路径</li>
<li><code>proxyUrl</code>：你最终希望通过API调用达到的proxyUrl</li>
</ul>
<p>修改<code>ionic.config.json</code>(旧版本Ionic CLI是<code>ionic.project</code>)：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;proxy-example&quot;,</span><br><span class="line">  &quot;app_id&quot;: &quot;&quot;,</span><br><span class="line">  &quot;proxies&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;path&quot;: &quot;/api&quot;, </span><br><span class="line">      &quot;proxyUrl&quot;: &quot;http://cors.api.com/api&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上所述，当您请求访问<code>http://localhost:8100/api</code>的ionic服务器时，它会替你代理请求到<code>http://cors.api.com/api</code>上。这样，就不需要CORS了。</p>
<h2 id="设置Angular-Constant"><a href="#设置Angular-Constant" class="headerlink" title="设置Angular Constant"></a>设置Angular Constant</h2><p>很容易将你的ApiEndpoint设置为Angular Constant。下面，我们已经将ApiEndpoint指定为我们的代理url。然后，我们就可以使用这个url作为一个常数。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">angular.module(&apos;starter&apos;, [&apos;ionic&apos;, &apos;starter.controllers&apos;, &apos;starter.services&apos;])</span><br><span class="line">.constant(&apos;ApiEndpoint&apos;, &#123;</span><br><span class="line">  url: &apos;http://localhost:8100/api&apos;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//For the real endpoint, we&apos;d use this</span><br><span class="line">// constant(&apos;ApiEndpoint&apos;, &#123;</span><br><span class="line">//  url: &apos;http://cors.api.com/api&apos;</span><br><span class="line">// &#125;)</span><br></pre></td></tr></table></figure>
<h2 id="设置Angular-Service"><a href="#设置Angular-Service" class="headerlink" title="设置Angular Service"></a>设置Angular Service</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">angular.module(&apos;starter.services&apos;, [])</span><br><span class="line"></span><br><span class="line">//NOTE: We are including the constant `ApiEndpoint` to be used here.</span><br><span class="line">.factory(&apos;Api&apos;, function($http, ApiEndpoint) &#123;</span><br><span class="line">  console.log(&apos;ApiEndpoint&apos;, ApiEndpoint)</span><br><span class="line"></span><br><span class="line">  var getApiData = function() &#123;</span><br><span class="line">    return $http.get(ApiEndpoint.url + &apos;/tasks&apos;)</span><br><span class="line">      .then(function(data) &#123;</span><br><span class="line">        console.log(&apos;Got some data: &apos;, data);</span><br><span class="line">        return data;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return &#123;</span><br><span class="line">    getApiData: getApiData</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="使用Gulp实现URL自动切换"><a href="#使用Gulp实现URL自动切换" class="headerlink" title="使用Gulp实现URL自动切换"></a>使用Gulp实现URL自动切换</h2><p>首先，需要安装<code>replace module</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save replace</span><br></pre></td></tr></table></figure>
<p>然后，我们需要修改<code>gulpfile.js</code>，并添加2个任务，来添加代理地址、移出代理地址。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// `npm install --save replace`</span><br><span class="line">var replace = require(&apos;replace&apos;);</span><br><span class="line">//注意下面的文件地址，它是包含你endpoint或baseurl的文件</span><br><span class="line">var replaceFiles = [&apos;./www/js/app.js&apos;];</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;add-proxy&apos;, function() &#123;</span><br><span class="line">  return replace(&#123;</span><br><span class="line">    regex: &quot;http://cors.api.com/api&quot;,</span><br><span class="line">    replacement: &quot;http://localhost:8100/api&quot;,</span><br><span class="line">    paths: replaceFiles,</span><br><span class="line">    recursive: false,</span><br><span class="line">    silent: false,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;remove-proxy&apos;, function() &#123;</span><br><span class="line">  return replace(&#123;</span><br><span class="line">    regex: &quot;http://localhost:8100/api&quot;,</span><br><span class="line">    replacement: &quot;http://cors.api.com/api&quot;,</span><br><span class="line">    paths: replaceFiles,</span><br><span class="line">    recursive: false,</span><br><span class="line">    silent: false,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>这个教程展示给你了在运行<code>ionic serve</code>或<code>ionic run -l</code>的时候，一个处理CORS问题的方法。</p>
<p>我们知道，如果按这个方法处理，当我们需要在<code>ionic serve</code>和<code>ionic run -l</code>切换的时候，将ApiEndpoint替换出来可能会比较麻烦。因此我们推荐使用gulp在程序启动时自动完成这个过程。</p>
<p>其实，最简单的处理CORS问题的方法，是要求你的api提供服务器来允许所有的<code>origin</code>。但是，有时候我们无法这么做。</p>
<p>使用Angular Constant和replace module会给我们一个愉快的解决方法来处理CORS问题。</p>
<p>如果你需要一个具体的例子，可以看一下这个<a href="https://github.com/driftyco/ionic-proxy-example" target="_blank" rel="noopener">示例工程</a>。</p>
<p>上面说的就是所有的当你访问一个API服务器时，关于处理CORS问题的全部。</p>
<p>如果你有疑问或想法，请在下面给我们评论，或者通过<a href="https://twitter.com/ionicframework" target="_blank" rel="noopener">twitter</a> or <a href="https://github.com/driftyco/ionic-cli" target="_blank" rel="noopener">github</a>.</p>
<hr>
<blockquote>
<p>文章翻译自：<a href="http://blog.ionic.io/handling-cors-issues-in-ionic/" target="_blank" rel="noopener">Handling CORS issues in Ionic，By Josh on February 24, 2015</a></p>
<p>译者：shaochong</p>
<p>说明：如果有翻译的不合适的地方，您可以联系（hao5743@163.com）我修改~</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/tx.jpeg"
                alt="Ethan Hunt" />
            
              <p class="site-author-name" itemprop="name">Ethan Hunt</p>
              <p class="site-description motion-element" itemprop="description">Make more time</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">56</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ethan Hunt</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
